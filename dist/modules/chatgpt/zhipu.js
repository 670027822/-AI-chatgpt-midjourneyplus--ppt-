'use strict';const _0x479df4=_0x1de1;function _0x1de1(_0x34aae9,_0x1b9fd4){const _0x4511b9=_0x4511();return _0x1de1=function(_0x1de11b,_0x4c3e6f){_0x1de11b=_0x1de11b-0xaa;let _0x53df71=_0x4511b9[_0x1de11b];return _0x53df71;},_0x1de1(_0x34aae9,_0x1b9fd4);}(function(_0x13bd72,_0x1595e4){const _0x1a62f0=_0x1de1,_0x241b24=_0x13bd72();while(!![]){try{const _0x307ca5=parseInt(_0x1a62f0(0xc2))/0x1*(-parseInt(_0x1a62f0(0xad))/0x2)+parseInt(_0x1a62f0(0xd1))/0x3+-parseInt(_0x1a62f0(0xac))/0x4+-parseInt(_0x1a62f0(0xd3))/0x5*(-parseInt(_0x1a62f0(0xbe))/0x6)+-parseInt(_0x1a62f0(0xb6))/0x7+-parseInt(_0x1a62f0(0xb7))/0x8*(parseInt(_0x1a62f0(0xbd))/0x9)+parseInt(_0x1a62f0(0xcf))/0xa;if(_0x307ca5===_0x1595e4)break;else _0x241b24['push'](_0x241b24['shift']());}catch(_0x1bb35e){_0x241b24['push'](_0x241b24['shift']());}}}(_0x4511,0x61ad2));Object[_0x479df4(0xc6)](exports,_0x479df4(0xb3),{'value':!![]}),exports[_0x479df4(0xc7)]=exports[_0x479df4(0xcc)]=exports[_0x479df4(0xb9)]=exports[_0x479df4(0xcd)]=void 0x0;const axios=require(_0x479df4(0xba)),jwt=require(_0x479df4(0xc1));function _0x4511(){const _0xffcde4=['axios','application/json','event:','161982HcODPh','24JlgPwE','usage','meta:','jsonwebtoken','720541RgfEsg','trim','replace','toString','defineProperty','sendMessageFromZhipu','text','HS256','parse','catch','compilerStream','generateToken','error:\x20','6968310GPytyZ','data:','2028855MfSKaS','SIGN','446515JMmrqG','/sse-invoke','end','sign','then','1525204Pvegeg','2jULKsj','id:','filter','round','error','split','__esModule','length','now','1094884YINdUr','32UxZUYU','https://open.bigmodel.cn/api/paas/v3/model-api/','compilerMetaJsonStr'];_0x4511=function(){return _0xffcde4;};return _0x4511();}function generateToken(_0x1a8727,_0x5b683c=0x3e8*0x3c*0x3c*0x18*0x168){const _0x45c526=_0x479df4,[_0x950d48,_0x1b05a8]=_0x1a8727[_0x45c526(0xb2)]('.'),_0x1005c6={'api_key':_0x950d48,'exp':Math[_0x45c526(0xb0)](Date[_0x45c526(0xb5)]())+_0x5b683c*0x3e8,'timestamp':Math[_0x45c526(0xb0)](Date[_0x45c526(0xb5)]())};return jwt[_0x45c526(0xaa)](_0x1005c6,_0x1b05a8,{'algorithm':_0x45c526(0xc9),'header':{'alg':'HS256','sign_type':_0x45c526(0xd2)}});}exports['generateToken']=generateToken;function compilerMetaJsonStr(_0x46c359){const _0x303e4b=_0x479df4;let _0x55b89e={};try{_0x55b89e=JSON[_0x303e4b(0xca)](_0x46c359);}catch(_0x1895f6){_0x55b89e={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x303e4b(0xb1)]('json\x20parse\x20error\x20from\x20zhipu!',_0x46c359);}return _0x55b89e;}exports[_0x479df4(0xb9)]=compilerMetaJsonStr;function compilerStream(_0x4e2eaf){const _0x279210=_0x479df4;var _0x3e753c;if(_0x4e2eaf[_0x279210(0xb4)]===0x3)return{'event':_0x4e2eaf[0x0][_0x279210(0xc4)]('event:',''),'id':_0x4e2eaf[0x1][_0x279210(0xc4)](_0x279210(0xae),''),'is_end':![],'result':_0x4e2eaf[0x2][_0x279210(0xc4)](_0x279210(0xd0),'')[_0x279210(0xc3)]()};if(_0x4e2eaf[_0x279210(0xb4)]===0x4)return{'event':_0x4e2eaf[0x0][_0x279210(0xc4)](_0x279210(0xbc),''),'id':_0x4e2eaf[0x1][_0x279210(0xc4)](_0x279210(0xae),''),'result':_0x4e2eaf[0x2]['replace']('data:','')[_0x279210(0xc3)](),'is_end':!![],'usage':(_0x3e753c=compilerMetaJsonStr(_0x4e2eaf[0x3]['replace'](_0x279210(0xc0),'')))===null||_0x3e753c===void 0x0?void 0x0:_0x3e753c[_0x279210(0xbf)]};}exports['compilerStream']=compilerStream;async function sendMessageFromZhipu(_0x51fb0e,{onProgress:_0xb4caf1,key:_0x1702c9,model:_0x1e3395,temperature:temperature=0.95}){const _0x522041=await generateToken(_0x1702c9);return new Promise((_0x35be63,_0x307ad3)=>{const _0x5c8518=_0x1de1,_0x1fd68c=_0x5c8518(0xb8)+_0x1e3395+_0x5c8518(0xd4),_0x107181={'method':'POST','url':_0x1fd68c,'responseType':'stream','headers':{'Content-Type':_0x5c8518(0xbb),'Authorization':_0x522041},'data':{'prompt':_0x51fb0e,'temperature':temperature}};axios(_0x107181)[_0x5c8518(0xab)](_0x191de7=>{const _0x20036a=_0x5c8518,_0x1ddd97=_0x191de7['data'];let _0x2019e6,_0x12b315='';_0x1ddd97['on']('data',_0x37a8da=>{const _0x145c23=_0x1de1,_0x4d3d5c=_0x37a8da[_0x145c23(0xc5)]()[_0x145c23(0xb2)]('\x0a')[_0x145c23(0xaf)](_0x25d2c1=>_0x25d2c1[_0x145c23(0xc3)]()!==''),_0x1af899=compilerStream(_0x4d3d5c);if(!_0x1af899)return;const {id:_0x366f55,result:_0x1c1bb2,is_end:_0xff71f3}=_0x1af899;_0x1c1bb2&&(_0x12b315+=_0x1c1bb2[_0x145c23(0xc3)]()),_0xff71f3&&(_0x1af899['is_end']=![],_0x2019e6=_0x1af899,_0x2019e6[_0x145c23(0xc8)]=_0x12b315),_0xb4caf1(_0x1af899);}),_0x1ddd97['on'](_0x20036a(0xd5),()=>{_0x35be63(_0x2019e6),_0x12b315='';});})[_0x5c8518(0xcb)](_0x584266=>{const _0x8cb141=_0x5c8518;console['log'](_0x8cb141(0xce),_0x584266);});});}exports[_0x479df4(0xc7)]=sendMessageFromZhipu;