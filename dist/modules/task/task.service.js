'use strict';const _0x103eb8=_0x2751;(function(_0x53ad72,_0x269325){const _0x4cf837=_0x2751,_0x121ba6=_0x53ad72();while(!![]){try{const _0x4017ce=-parseInt(_0x4cf837(0xba))/0x1+parseInt(_0x4cf837(0xc7))/0x2+parseInt(_0x4cf837(0xd6))/0x3+-parseInt(_0x4cf837(0xa5))/0x4+-parseInt(_0x4cf837(0xd5))/0x5+parseInt(_0x4cf837(0xd4))/0x6*(parseInt(_0x4cf837(0xc4))/0x7)+parseInt(_0x4cf837(0xc5))/0x8;if(_0x4017ce===_0x269325)break;else _0x121ba6['push'](_0x121ba6['shift']());}catch(_0x2bd30c){_0x121ba6['push'](_0x121ba6['shift']());}}}(_0x376f,0x7853d));function _0x2751(_0xc4d103,_0x125143){const _0x376fab=_0x376f();return _0x2751=function(_0x275158,_0x331e8f){_0x275158=_0x275158-0xa4;let _0x284d22=_0x376fab[_0x275158];return _0x284d22;},_0x2751(_0xc4d103,_0x125143);}var __decorate=this&&this[_0x103eb8(0xc8)]||function(_0x29ddd6,_0x2e80ef,_0xbec1b0,_0x2e2840){const _0xfddd63=_0x103eb8;var _0x2857a4=arguments[_0xfddd63(0xb3)],_0x5c79e2=_0x2857a4<0x3?_0x2e80ef:_0x2e2840===null?_0x2e2840=Object['getOwnPropertyDescriptor'](_0x2e80ef,_0xbec1b0):_0x2e2840,_0x5d9b29;if(typeof Reflect===_0xfddd63(0xa6)&&typeof Reflect[_0xfddd63(0xd0)]===_0xfddd63(0xa4))_0x5c79e2=Reflect['decorate'](_0x29ddd6,_0x2e80ef,_0xbec1b0,_0x2e2840);else{for(var _0x154061=_0x29ddd6['length']-0x1;_0x154061>=0x0;_0x154061--)if(_0x5d9b29=_0x29ddd6[_0x154061])_0x5c79e2=(_0x2857a4<0x3?_0x5d9b29(_0x5c79e2):_0x2857a4>0x3?_0x5d9b29(_0x2e80ef,_0xbec1b0,_0x5c79e2):_0x5d9b29(_0x2e80ef,_0xbec1b0))||_0x5c79e2;}return _0x2857a4>0x3&&_0x5c79e2&&Object[_0xfddd63(0xa9)](_0x2e80ef,_0xbec1b0,_0x5c79e2),_0x5c79e2;},__metadata=this&&this[_0x103eb8(0xd3)]||function(_0x3b1757,_0x1662b1){const _0x371e53=_0x103eb8;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x371e53(0xa4))return Reflect['metadata'](_0x3b1757,_0x1662b1);},__param=this&&this[_0x103eb8(0xcf)]||function(_0x456849,_0xba95ca){return function(_0x1c0677,_0x13cf47){_0xba95ca(_0x1c0677,_0x13cf47,_0x456849);};};Object['defineProperty'](exports,_0x103eb8(0xaa),{'value':!![]}),exports[_0x103eb8(0xc3)]=void 0x0;const globalConfig_service_1=require(_0x103eb8(0xbb)),common_1=require('@nestjs/common'),schedule_1=require(_0x103eb8(0xb6)),userBalance_entity_1=require('../userBalance/userBalance.entity'),typeorm_1=require(_0x103eb8(0xb9)),typeorm_2=require('typeorm'),models_service_1=require(_0x103eb8(0xb8));function _0x376f(){const _0x58d7a9=['refreshBaiduAccesstoken','../models/models.service','@nestjs/typeorm','277113PPSgrf','./../globalConfig/globalConfig.service','globalConfigService','Logger','0\x200\x20*/5\x20*\x20*','checsongshu','Cron','debug','EVERY_5_MINUTES','TaskService','7TsmONo','5660400Wzaycf','design:paramtypes','460040NWoTMM','__decorate','LessThanOrEqual','Injectable','userBalanceEntity','check\x20key','checauth','prototype','__param','decorate','UserBalanceEntity','InjectRepository','__metadata','2353404xaaIhg','391025pqflZx','1022832EMsHcc','handleCron','function','3290276jGUniD','object','ModelsService','getWechatAccessToken','defineProperty','__esModule','GlobalConfigService','EVERY_5_HOURS','Repository','CronExpression','modelsService','design:returntype','find','design:type','length','checkUserMemerExpire','update','@nestjs/schedule'];_0x376f=function(){return _0x58d7a9;};return _0x376f();}let TaskService=class TaskService{constructor(_0x683ed,_0x2add28,_0x27af40){const _0x4d1495=_0x103eb8;this['userBalanceEntity']=_0x683ed,this[_0x4d1495(0xbc)]=_0x2add28,this[_0x4d1495(0xaf)]=_0x27af40;}[_0x103eb8(0xd7)](){const _0x593439=_0x103eb8;common_1[_0x593439(0xbd)][_0x593439(0xc1)]('Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token','TaskService'),this['globalConfigService'][_0x593439(0xa8)]();}async[_0x103eb8(0xb4)](){const _0x2f3b19=_0x103eb8,_0x5d7e97=await this[_0x2f3b19(0xcb)][_0x2f3b19(0xb1)]({'where':{'expirationTime':(0x0,typeorm_2[_0x2f3b19(0xc9)])(new Date())}});if(!_0x5d7e97||!_0x5d7e97[_0x2f3b19(0xb3)])return;_0x5d7e97['forEach'](_0x3f593c=>{const _0x39dcd2=_0x2f3b19;this[_0x39dcd2(0xcb)][_0x39dcd2(0xb5)]({'id':_0x3f593c['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})['then'](_0x124f5c=>{const _0x82fe6c=_0x39dcd2;common_1[_0x82fe6c(0xbd)][_0x82fe6c(0xc1)](_0x3f593c['id']+'会员已到期、清空所有余额并移除会员身份！','TaskService');});});}[_0x103eb8(0xb7)](){this['modelsService']['refreshBaiduAccesstoken']();}['checauth'](){const _0x3aa5b8=_0x103eb8;common_1[_0x3aa5b8(0xbd)][_0x3aa5b8(0xc1)]('check\x20ip'),this['globalConfigService']['auth']();}[_0x103eb8(0xbf)](){const _0x30c241=_0x103eb8;common_1['Logger']['debug'](_0x30c241(0xcc)),this[_0x30c241(0xbc)][_0x30c241(0xbf)]();}};__decorate([(0x0,schedule_1[_0x103eb8(0xc0)])(schedule_1[_0x103eb8(0xae)]['EVERY_HOUR']),__metadata(_0x103eb8(0xb2),Function),__metadata('design:paramtypes',[]),__metadata(_0x103eb8(0xb0),void 0x0)],TaskService['prototype'],_0x103eb8(0xd7),null),__decorate([(0x0,schedule_1[_0x103eb8(0xc0)])(schedule_1[_0x103eb8(0xae)][_0x103eb8(0xc2)]),__metadata(_0x103eb8(0xb2),Function),__metadata(_0x103eb8(0xc6),[]),__metadata('design:returntype',Promise)],TaskService[_0x103eb8(0xce)],_0x103eb8(0xb4),null),__decorate([(0x0,schedule_1[_0x103eb8(0xc0)])(_0x103eb8(0xbe)),__metadata('design:type',Function),__metadata(_0x103eb8(0xc6),[]),__metadata(_0x103eb8(0xb0),void 0x0)],TaskService['prototype'],_0x103eb8(0xb7),null),__decorate([(0x0,schedule_1[_0x103eb8(0xc0)])(schedule_1[_0x103eb8(0xae)][_0x103eb8(0xac)]),__metadata(_0x103eb8(0xb2),Function),__metadata(_0x103eb8(0xc6),[]),__metadata(_0x103eb8(0xb0),void 0x0)],TaskService[_0x103eb8(0xce)],_0x103eb8(0xcd),null),__decorate([(0x0,schedule_1['Cron'])(schedule_1[_0x103eb8(0xae)][_0x103eb8(0xac)]),__metadata(_0x103eb8(0xb2),Function),__metadata(_0x103eb8(0xc6),[]),__metadata('design:returntype',void 0x0)],TaskService['prototype'],_0x103eb8(0xbf),null),TaskService=__decorate([(0x0,common_1[_0x103eb8(0xca)])(),__param(0x0,(0x0,typeorm_1[_0x103eb8(0xd2)])(userBalance_entity_1[_0x103eb8(0xd1)])),__metadata('design:paramtypes',[typeorm_2[_0x103eb8(0xad)],globalConfig_service_1[_0x103eb8(0xab)],models_service_1[_0x103eb8(0xa7)]])],TaskService),exports['TaskService']=TaskService;