'use strict';const _0x30d0aa=_0x508f;(function(_0x533288,_0x23bf4c){const _0x19c3e3=_0x508f,_0x3a88a1=_0x533288();while(!![]){try{const _0x6cac74=-parseInt(_0x19c3e3(0x12c))/0x1*(-parseInt(_0x19c3e3(0x117))/0x2)+-parseInt(_0x19c3e3(0xfb))/0x3+parseInt(_0x19c3e3(0x11b))/0x4*(parseInt(_0x19c3e3(0x132))/0x5)+-parseInt(_0x19c3e3(0xfe))/0x6+-parseInt(_0x19c3e3(0x13d))/0x7+parseInt(_0x19c3e3(0x113))/0x8*(-parseInt(_0x19c3e3(0xf1))/0x9)+parseInt(_0x19c3e3(0x128))/0xa*(parseInt(_0x19c3e3(0x106))/0xb);if(_0x6cac74===_0x23bf4c)break;else _0x3a88a1['push'](_0x3a88a1['shift']());}catch(_0xe346ff){_0x3a88a1['push'](_0x3a88a1['shift']());}}}(_0x3a3d,0x5094a));function _0x508f(_0x821637,_0x1aed47){const _0x3a3d8d=_0x3a3d();return _0x508f=function(_0x508fae,_0x12e7a9){_0x508fae=_0x508fae-0xef;let _0x5af648=_0x3a3d8d[_0x508fae];return _0x5af648;},_0x508f(_0x821637,_0x1aed47);}var __decorate=this&&this['__decorate']||function(_0x215245,_0x3ddcdc,_0x10f65e,_0x5ef95f){const _0x1d0508=_0x508f;var _0x38c0ec=arguments[_0x1d0508(0x115)],_0x395202=_0x38c0ec<0x3?_0x3ddcdc:_0x5ef95f===null?_0x5ef95f=Object[_0x1d0508(0x12e)](_0x3ddcdc,_0x10f65e):_0x5ef95f,_0x480ef9;if(typeof Reflect===_0x1d0508(0x12b)&&typeof Reflect[_0x1d0508(0x114)]==='function')_0x395202=Reflect['decorate'](_0x215245,_0x3ddcdc,_0x10f65e,_0x5ef95f);else{for(var _0x202067=_0x215245[_0x1d0508(0x115)]-0x1;_0x202067>=0x0;_0x202067--)if(_0x480ef9=_0x215245[_0x202067])_0x395202=(_0x38c0ec<0x3?_0x480ef9(_0x395202):_0x38c0ec>0x3?_0x480ef9(_0x3ddcdc,_0x10f65e,_0x395202):_0x480ef9(_0x3ddcdc,_0x10f65e))||_0x395202;}return _0x38c0ec>0x3&&_0x395202&&Object[_0x1d0508(0x107)](_0x3ddcdc,_0x10f65e,_0x395202),_0x395202;},__metadata=this&&this[_0x30d0aa(0x11f)]||function(_0x19969c,_0x3ebef6){const _0x36cbf3=_0x30d0aa;if(typeof Reflect===_0x36cbf3(0x12b)&&typeof Reflect['metadata']===_0x36cbf3(0x13c))return Reflect[_0x36cbf3(0xf8)](_0x19969c,_0x3ebef6);},__param=this&&this[_0x30d0aa(0xf6)]||function(_0x3eb450,_0x439e26){return function(_0x179d17,_0x579fe5){_0x439e26(_0x179d17,_0x579fe5,_0x3eb450);};};Object[_0x30d0aa(0x107)](exports,_0x30d0aa(0xf9),{'value':!![]}),exports[_0x30d0aa(0x135)]=void 0x0;const user_entity_1=require('./../user/user.entity'),typeorm_1=require(_0x30d0aa(0xf7)),common_1=require(_0x30d0aa(0xef)),typeorm_2=require(_0x30d0aa(0x13a)),order_entity_1=require(_0x30d0aa(0x12f)),cramiPackage_entity_1=require(_0x30d0aa(0x10d)),utils_1=require(_0x30d0aa(0x112)),pay_service_1=require('../pay/pay.service'),globalConfig_service_1=require(_0x30d0aa(0xf0));let OrderService=class OrderService{constructor(_0x5752e4,_0x558f0a,_0xedc15b,_0x517f5b,_0x4c8c46){const _0x1a35d2=_0x30d0aa;this[_0x1a35d2(0x141)]=_0x5752e4,this[_0x1a35d2(0xfc)]=_0x558f0a,this[_0x1a35d2(0x140)]=_0xedc15b,this[_0x1a35d2(0x13f)]=_0x517f5b,this[_0x1a35d2(0x13b)]=_0x4c8c46;}async[_0x30d0aa(0x121)](_0xe7455e,_0xd14c9){const _0xf4dc15=_0x30d0aa;try{const {goodsId:_0xbe409d,count:count=0x1,payType:_0x4ab50b}=_0xe7455e,{id:_0x23c3d9}=_0xd14c9['user'];if(_0x23c3d9>0xf4240)throw new common_1[(_0xf4dc15(0x103))](_0xf4dc15(0x11e),common_1[_0xf4dc15(0x129)][_0xf4dc15(0x105)]);const _0x5f3b72=await this[_0xf4dc15(0x10b)](_0x23c3d9,_0xbe409d,count,_0x4ab50b),_0x1574a0=await this['payService'][_0xf4dc15(0x10c)](_0x23c3d9,_0x5f3b72[_0xf4dc15(0x136)],_0x4ab50b);return Object[_0xf4dc15(0x109)](Object[_0xf4dc15(0x109)]({},_0x1574a0),{'orderId':_0x5f3b72[_0xf4dc15(0x136)],'platform':_0x5f3b72['payPlatform'],'total':_0x5f3b72[_0xf4dc15(0x11d)]});}catch(_0x2932b1){if(_0x2932b1[_0xf4dc15(0x100)]===0x191)throw new common_1[(_0xf4dc15(0x103))](_0x2932b1[_0xf4dc15(0x138)],common_1['HttpStatus'][_0xf4dc15(0x105)]);throw new common_1['HttpException'](_0x2932b1[_0xf4dc15(0x138)]||_0xf4dc15(0xff),common_1['HttpStatus']['BAD_REQUEST']);}}async['queryByOrderId'](_0x8d37d9,_0x324128){const _0x5ac83f=_0x30d0aa,{id:_0x3b0d3e}=_0x8d37d9[_0x5ac83f(0x126)],{orderId:_0x11f2f8}=_0x324128,_0x14c973=await this['orderEntity'][_0x5ac83f(0x11a)]({'where':{'userId':_0x3b0d3e,'orderId':_0x11f2f8}});if(!_0x14c973)throw new common_1[(_0x5ac83f(0x103))]('订单不存在!',common_1[_0x5ac83f(0x129)][_0x5ac83f(0x102)]);return _0x14c973;}async[_0x30d0aa(0x10b)](_0x26a1c0,_0xe5bcb1,_0x1e0ace,_0x3b1409){const _0x5b3e17=_0x30d0aa,_0x38a02b=await this[_0x5b3e17(0x13b)][_0x5b3e17(0x12d)](),_0x157e42=await this[_0x5b3e17(0xfc)][_0x5b3e17(0x11a)]({'where':{'id':_0xe5bcb1}});if(!_0x157e42)throw new common_1[(_0x5b3e17(0x103))](_0x5b3e17(0x10e),common_1[_0x5b3e17(0x129)][_0x5b3e17(0x102)]);const _0x2297a3={};_0x2297a3[_0x5b3e17(0x136)]=(0x0,utils_1['createOrderId'])(),_0x2297a3[_0x5b3e17(0x116)]=_0x26a1c0,_0x2297a3[_0x5b3e17(0x120)]=_0xe5bcb1,_0x2297a3['price']=Number(_0x157e42[_0x5b3e17(0x130)]),_0x2297a3[_0x5b3e17(0x10a)]=_0x1e0ace,_0x2297a3[_0x5b3e17(0x11d)]=Number(_0x157e42[_0x5b3e17(0x130)])*_0x1e0ace,_0x2297a3[_0x5b3e17(0xfa)]=_0x38a02b,_0x2297a3[_0x5b3e17(0xf5)]=_0x3b1409;const _0x49b9bb=await this['orderEntity'][_0x5b3e17(0x111)](_0x2297a3);return console['log'](_0x5b3e17(0x104),_0x49b9bb),_0x49b9bb;}async[_0x30d0aa(0x11c)](_0x3c11a1,_0x4da516,_0x4e8bb3){return await this['orderEntity']['findAndCount']({'where':{'userId':_0x3c11a1},'order':{'id':'DESC'},'skip':(_0x4da516-0x1)*_0x4e8bb3,'take':_0x4e8bb3});}async[_0x30d0aa(0xfd)](_0x1d4ede){const _0x270a62=_0x30d0aa,{page:_0x501453,size:_0x3ea079,userId:_0x124235,platform:_0x13898c,status:_0x4d74e1}=_0x1d4ede,_0x323cbd={};if(_0x124235)_0x323cbd[_0x270a62(0x116)]=_0x124235;if(_0x13898c)_0x323cbd[_0x270a62(0xfa)]=_0x13898c;if(_0x4d74e1)_0x323cbd[_0x270a62(0x100)]=_0x4d74e1;const [_0x702f3d,_0x564f23]=await this[_0x270a62(0x141)][_0x270a62(0xf4)]({'order':{'id':'DESC'},'where':_0x323cbd,'skip':(_0x501453-0x1)*_0x3ea079,'take':_0x3ea079}),_0x374f79=_0x702f3d[_0x270a62(0x122)](_0x1b63c8=>_0x1b63c8[_0x270a62(0x116)]),_0xbb3568=_0x702f3d[_0x270a62(0x122)](_0xb8840a=>_0xb8840a[_0x270a62(0x120)]),_0x11439e=await this[_0x270a62(0x140)][_0x270a62(0x139)]({'where':{'id':(0x0,typeorm_2['In'])(_0x374f79)},'select':['id','username',_0x270a62(0x125)]}),_0x375b23=await this[_0x270a62(0xfc)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0xbb3568)},'select':['id','name',_0x270a62(0x108),_0x270a62(0x119)]});_0x702f3d[_0x270a62(0x131)](_0x56e0b9=>{const _0xe6e44c=_0x270a62;_0x56e0b9['userInfo']=_0x11439e[_0xe6e44c(0x139)](_0x31e9e8=>_0x31e9e8['id']===_0x56e0b9[_0xe6e44c(0x116)]),_0x56e0b9['goodsInfo']=_0x375b23[_0xe6e44c(0x139)](_0x3ab7e7=>_0x3ab7e7['id']===_0x56e0b9[_0xe6e44c(0x120)]);});const _0x3f46c6=await this[_0x270a62(0x141)]['createQueryBuilder']('order')[_0x270a62(0x12a)](_0x270a62(0x133),{'status':0x1})['select']('SUM(order.price)',_0x270a62(0x13e))['getRawOne']();return Object[_0x270a62(0x109)]({'rows':_0x702f3d,'count':_0x564f23},_0x3f46c6);}async[_0x30d0aa(0x123)](_0x118a91){const _0x1931de=_0x30d0aa,{orderId:_0x5cc7d8}=_0x118a91,_0x550488=await this[_0x1931de(0x141)][_0x1931de(0x11a)]({'where':{'orderId':_0x5cc7d8}});if(!_0x550488)throw new common_1[(_0x1931de(0x103))]('订单不存在!',common_1[_0x1931de(0x129)][_0x1931de(0x102)]);return await this[_0x1931de(0x141)]['delete']({'orderId':_0x5cc7d8});}async[_0x30d0aa(0x134)](){const _0x498819=_0x30d0aa;return await this[_0x498819(0x141)][_0x498819(0xf3)]({'status':0x0});}};function _0x3a3d(){const _0x10b650=['queryPayType','getOwnPropertyDescriptor','./order.entity','price','forEach','1840EPaMZf','order.status\x20=\x20:status','deleteNotPay','OrderService','orderId','design:paramtypes','message','find','typeorm','globalConfigService','function','3486455BIYcxt','total_price','payService','userEntity','orderEntity','@nestjs/common','../globalConfig/globalConfig.service','531beqEyl','Repository','delete','findAndCount','channel','__param','@nestjs/typeorm','metadata','__esModule','payPlatform','873588aYQEQo','cramiPackageEntity','queryAllOrder','2544186tmtCIb','购买失败!','status','PayService','BAD_REQUEST','HttpException','order:\x20','UNAUTHORIZED','10051129gUUZSx','defineProperty','coverImg','assign','count','create','pay','../crami/cramiPackage.entity','套餐不存在!','GlobalConfigService','Injectable','save','../../common/utils','78448AnHSgZ','decorate','length','userId','109534QcZhiv','CramiPackageEntity','des','findOne','6584wduLow','query','total','请先注册账号后购买商品！','__metadata','goodsId','buy','map','deleteOrder','InjectRepository','email','user','UserEntity','10wOnxbg','HttpStatus','where','object','11VVeNRk'];_0x3a3d=function(){return _0x10b650;};return _0x3a3d();}OrderService=__decorate([(0x0,common_1[_0x30d0aa(0x110)])(),__param(0x0,(0x0,typeorm_1[_0x30d0aa(0x124)])(order_entity_1['OrderEntity'])),__param(0x1,(0x0,typeorm_1[_0x30d0aa(0x124)])(cramiPackage_entity_1[_0x30d0aa(0x118)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x30d0aa(0x127)])),__metadata(_0x30d0aa(0x137),[typeorm_2[_0x30d0aa(0xf2)],typeorm_2[_0x30d0aa(0xf2)],typeorm_2['Repository'],pay_service_1[_0x30d0aa(0x101)],globalConfig_service_1[_0x30d0aa(0x10f)]])],OrderService),exports[_0x30d0aa(0x135)]=OrderService;