'use strict';const _0x3d2636=_0x133d;function _0x133d(_0x51658b,_0x519009){const _0x4cb3d6=_0x4cb3();return _0x133d=function(_0x133ded,_0x2bd5cf){_0x133ded=_0x133ded-0xe1;let _0x367974=_0x4cb3d6[_0x133ded];return _0x367974;},_0x133d(_0x51658b,_0x519009);}(function(_0x24e49a,_0x5d0e42){const _0x4374dd=_0x133d,_0x654ee3=_0x24e49a();while(!![]){try{const _0x393c81=-parseInt(_0x4374dd(0x135))/0x1*(-parseInt(_0x4374dd(0x122))/0x2)+-parseInt(_0x4374dd(0x103))/0x3*(parseInt(_0x4374dd(0x106))/0x4)+-parseInt(_0x4374dd(0x108))/0x5+parseInt(_0x4374dd(0xe4))/0x6*(parseInt(_0x4374dd(0x116))/0x7)+parseInt(_0x4374dd(0x148))/0x8+parseInt(_0x4374dd(0x10d))/0x9*(-parseInt(_0x4374dd(0xe8))/0xa)+parseInt(_0x4374dd(0xf8))/0xb*(-parseInt(_0x4374dd(0xfa))/0xc);if(_0x393c81===_0x5d0e42)break;else _0x654ee3['push'](_0x654ee3['shift']());}catch(_0x5d4cd1){_0x654ee3['push'](_0x654ee3['shift']());}}}(_0x4cb3,0xdc496));var __decorate=this&&this[_0x3d2636(0x111)]||function(_0x1cf6fe,_0x37b603,_0x1833c9,_0xf5684){const _0x531823=_0x3d2636;var _0x519d8d=arguments[_0x531823(0x151)],_0x4bfaca=_0x519d8d<0x3?_0x37b603:_0xf5684===null?_0xf5684=Object['getOwnPropertyDescriptor'](_0x37b603,_0x1833c9):_0xf5684,_0x49a7f8;if(typeof Reflect===_0x531823(0x138)&&typeof Reflect[_0x531823(0x131)]===_0x531823(0x125))_0x4bfaca=Reflect[_0x531823(0x131)](_0x1cf6fe,_0x37b603,_0x1833c9,_0xf5684);else{for(var _0x586de1=_0x1cf6fe[_0x531823(0x151)]-0x1;_0x586de1>=0x0;_0x586de1--)if(_0x49a7f8=_0x1cf6fe[_0x586de1])_0x4bfaca=(_0x519d8d<0x3?_0x49a7f8(_0x4bfaca):_0x519d8d>0x3?_0x49a7f8(_0x37b603,_0x1833c9,_0x4bfaca):_0x49a7f8(_0x37b603,_0x1833c9))||_0x4bfaca;}return _0x519d8d>0x3&&_0x4bfaca&&Object['defineProperty'](_0x37b603,_0x1833c9,_0x4bfaca),_0x4bfaca;},__metadata=this&&this['__metadata']||function(_0x203e6e,_0x2d0784){const _0x118662=_0x3d2636;if(typeof Reflect===_0x118662(0x138)&&typeof Reflect[_0x118662(0x14b)]===_0x118662(0x125))return Reflect[_0x118662(0x14b)](_0x203e6e,_0x2d0784);},__param=this&&this[_0x3d2636(0x143)]||function(_0x19fbff,_0x19a4b1){return function(_0x1b0ced,_0x2fc505){_0x19a4b1(_0x1b0ced,_0x2fc505,_0x19fbff);};};function _0x4cb3(){const _0x4072b2=['checkBadWords','globalConfigService','12449776GeBUow','badWords','HttpStatus','metadata','BadwordsService','../user/user.entity','super','design:paramtypes','error:\x20','length','delete','includes','userEntity','***','UserEntity','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','395292zOfAgy','Like','update','push','1140lnSfAs','msg','typeOriginCn','百度云检测','HttpException','find','Repository','formarTips','userId','status','baiduCheckBadWords','save','@nestjs/common','violation','getSensitiveConfig','BadWordsEntity','11FEWsAg','./badwords.entity','3441036ueagYS','application/json','category','./violationLog.entity','@nestjs/typeorm','onModuleInit','自定义检测','application/x-www-form-urlencoded','default','18GhihLX','forEach','word','598604dBjzGs','nineaiCheckBadWords','5537315QSCKpj','您提交的内容中包含','violationLogEntity','您提交的信息中包含','敏感词检测\x20|\x20','117657LbxYXX','set','email','nineai','__decorate','customSensitiveWords','data','findAndCount','ViolationLogEntity','154RAPOww','./../globalConfig/globalConfig.service','affected','添加敏感词成功','findOne','loadBadWords','checkBadWordsByConfig','自定义','敏感词已经存在了、请勿重复添加','queryBadWords','delBadWords','baidu','144CdCctQ','updateBadWords','检测失败','function','删除敏感词失败','word_list','map','敏感词不存在,请检查您的提交信息','InjectRepository','更新敏感词成功','baiduTextAccessToken','ASC','typeorm','BAD_REQUEST','extractContent','decorate','badWordsEntity','GlobalConfigService','user','23321bGamYY','hideString','__esModule','object','id\x20=\x20:userId','stringify','join','post','log','where','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','更新敏感词失败','code','DESC','__param','addBadWord','recordUserBadWords'];_0x4cb3=function(){return _0x4072b2;};return _0x4cb3();}Object['defineProperty'](exports,_0x3d2636(0x137),{'value':!![]}),exports[_0x3d2636(0x14c)]=void 0x0;const globalConfig_service_1=require(_0x3d2636(0x117)),common_1=require(_0x3d2636(0xf4)),badwords_entity_1=require(_0x3d2636(0xf9)),typeorm_1=require(_0x3d2636(0x12e)),typeorm_2=require(_0x3d2636(0xfe)),axios_1=require('axios'),violationLog_entity_1=require(_0x3d2636(0xfd)),user_entity_1=require(_0x3d2636(0x14d)),utils_1=require('../../common/utils');let BadwordsService=class BadwordsService{constructor(_0x22c56d,_0x2d589c,_0x89582d,_0x28451a){const _0xe5b380=_0x3d2636;this['badWordsEntity']=_0x22c56d,this[_0xe5b380(0x10a)]=_0x2d589c,this[_0xe5b380(0x154)]=_0x89582d,this[_0xe5b380(0x147)]=_0x28451a,this[_0xe5b380(0x149)]=[];}async[_0x3d2636(0xff)](){const _0x17af92=_0x3d2636;this[_0x17af92(0x11b)]();}async['customSensitiveWords'](_0x57c405,_0x51928d){const _0x5befdd=_0x3d2636,_0x39eafb=[];for(let _0x1262c0=0x0;_0x1262c0<this[_0x5befdd(0x149)][_0x5befdd(0x151)];_0x1262c0++){const _0x18194d=this['badWords'][_0x1262c0];_0x57c405[_0x5befdd(0x153)](_0x18194d)&&_0x39eafb[_0x5befdd(0xe7)](_0x18194d);}if(_0x39eafb[_0x5befdd(0x151)]){await this['recordUserBadWords'](_0x51928d,_0x57c405,_0x39eafb,[_0x5befdd(0x11d)],_0x5befdd(0x100));const _0x92b62b=_0x5befdd(0x13f);throw new common_1[(_0x5befdd(0xec))](_0x92b62b,common_1['HttpStatus'][_0x5befdd(0x12f)]);}}async[_0x3d2636(0x146)](_0xfbc6f0,_0xba89d6){const _0x3a07aa=_0x3d2636,_0x46509b=await this['globalConfigService'][_0x3a07aa(0xf6)]();_0x46509b&&await this[_0x3a07aa(0x11c)](_0xfbc6f0,_0x46509b,_0xba89d6),await this[_0x3a07aa(0x112)](_0xfbc6f0,_0xba89d6);}async[_0x3d2636(0x11c)](_0x14a11e,_0x42c585,_0x3bcf73){const _0x2aa1a7=_0x3d2636,{useType:_0x66b655}=_0x42c585;_0x66b655===_0x2aa1a7(0x121)&&await this[_0x2aa1a7(0xf2)](_0x14a11e,_0x42c585[_0x2aa1a7(0x12c)],_0x3bcf73),_0x66b655===_0x2aa1a7(0x110)&&await this[_0x2aa1a7(0x107)](_0x14a11e,_0x42c585,_0x3bcf73);}[_0x3d2636(0x130)](_0x566e1c){const _0x272b11=/存在(.*?)不合规/,_0x2e96c1=_0x566e1c['match'](_0x272b11);return _0x2e96c1?_0x2e96c1[0x1]:'';}async['baiduCheckBadWords'](_0x5d8392,_0x2f8d09,_0x1c7daf){const _0x2a3117=_0x3d2636;if(!_0x2f8d09)return;const _0x3ccdb6=_0x2a3117(0xe3)+_0x2f8d09+'}',_0x31e648={'Content-Type':_0x2a3117(0x101),'Accept':_0x2a3117(0xfb)},_0x2391b6=await axios_1[_0x2a3117(0x102)][_0x2a3117(0x13c)](_0x3ccdb6,{'text':_0x5d8392},{'headers':_0x31e648}),{conclusion:_0x136851,error_code:_0x1e0f85,error_msg:_0x32e17d,conclusionType:_0x48035c,data:_0x4c814a}=_0x2391b6[_0x2a3117(0x113)];_0x1e0f85&&console[_0x2a3117(0x13d)]('百度文本检测出现错误、请查看配置信息:\x20',_0x32e17d);if(_0x48035c!==0x1){const _0x5f241e=[...new Set(_0x4c814a[_0x2a3117(0x128)](_0x2cab34=>this[_0x2a3117(0x130)](_0x2cab34[_0x2a3117(0xe9)])))];await this[_0x2a3117(0x145)](_0x1c7daf,_0x5d8392,[_0x2a3117(0xe1)],_0x5f241e,_0x2a3117(0xeb));const _0x52b4e3=_0x2a3117(0x10b)+_0x5f241e[_0x2a3117(0x13b)](',')+'的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1[(_0x2a3117(0xec))](_0x52b4e3,common_1[_0x2a3117(0x14a)][_0x2a3117(0x12f)]);}}async[_0x3d2636(0x107)](_0x5abe58,_0x16dee2,_0x3338f2){const _0xef115e=_0x3d2636;var _0x56e5f7;const {nineaiBuiltInSensitiveApiBase:_0x736c54,nineaiBuiltInSensitiveAuthKey:_0x27bb5d}=_0x16dee2;if(!_0x736c54||!_0x27bb5d)return;const _0x379e88=await axios_1[_0xef115e(0x102)][_0xef115e(0x13c)](_0x736c54,{'content':_0x5abe58},{'headers':{'Content-Type':'application/json','Authorization':_0x27bb5d}});if(!_0x379e88[_0xef115e(0x113)])return;if(_0x379e88[_0xef115e(0x113)][_0xef115e(0x141)]!=='0'){const {msg:msg=_0xef115e(0x124)}=_0x379e88[_0xef115e(0x113)];throw new common_1[(_0xef115e(0xec))](_0xef115e(0x10c)+msg,common_1[_0xef115e(0x14a)][_0xef115e(0x12f)]);}if(_0x379e88[_0xef115e(0x113)][_0xef115e(0x127)]&&((_0x56e5f7=_0x379e88[_0xef115e(0x113)][_0xef115e(0x127)])===null||_0x56e5f7===void 0x0?void 0x0:_0x56e5f7['length'])){const _0x5c4af6=[...new Set(_0x379e88[_0xef115e(0x113)][_0xef115e(0x127)][_0xef115e(0x128)](_0xf66678=>_0xf66678['keyword']))],_0x173f0a=[...new Set(_0x379e88[_0xef115e(0x113)]['word_list'][_0xef115e(0x128)](_0x229147=>_0x229147[_0xef115e(0xfc)]))];await this['recordUserBadWords'](_0x3338f2,_0x5abe58,_0x5c4af6,_0x173f0a,'NineAi检测');const _0x4b6505=this['formarTips'](_0x379e88['data'][_0xef115e(0x127)]);throw new common_1[(_0xef115e(0xec))](_0x4b6505,common_1[_0xef115e(0x14a)]['BAD_REQUEST']);}}[_0x3d2636(0xef)](_0x3801b6){const _0x4ae9c5=_0x3d2636,_0x50cc40=_0x3801b6[_0x4ae9c5(0x128)](_0x1400c2=>_0x1400c2[_0x4ae9c5(0xfc)]),_0x1d4282=[...new Set(_0x50cc40)];return _0x4ae9c5(0x109)+_0x1d4282[_0x4ae9c5(0x13b)](',')+'的信息、我们已对您账号进行标记、请合规使用！';}async[_0x3d2636(0x11b)](){const _0x414021=_0x3d2636,_0x1896e6=await this[_0x414021(0x132)][_0x414021(0xed)]({'where':{'status':0x1},'select':['word']});this[_0x414021(0x149)]=_0x1896e6['map'](_0x20bec7=>_0x20bec7[_0x414021(0x105)]);}async[_0x3d2636(0x11f)](_0x119af0){const _0x5812fc=_0x3d2636,{page:page=0x1,size:size=0x1f4,word:_0x53d0ae,status:_0xb4a8a6}=_0x119af0,_0x36da9c={};[0x0,0x1,'0','1'][_0x5812fc(0x153)](_0xb4a8a6)&&(_0x36da9c[_0x5812fc(0xf1)]=_0xb4a8a6),_0x53d0ae&&(_0x36da9c[_0x5812fc(0x105)]=(0x0,typeorm_1[_0x5812fc(0xe5)])('%'+_0x53d0ae+'%'));const [_0x3f00db,_0x4ce8ea]=await this[_0x5812fc(0x132)][_0x5812fc(0x114)]({'where':_0x36da9c,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x5812fc(0x12d)}});return{'rows':_0x3f00db,'count':_0x4ce8ea};}async[_0x3d2636(0x120)](_0x223d25){const _0x1c1d5b=_0x3d2636,_0x32e60e=await this['badWordsEntity'][_0x1c1d5b(0x11a)]({'where':{'id':_0x223d25['id']}});if(!_0x32e60e)throw new common_1[(_0x1c1d5b(0xec))](_0x1c1d5b(0x129),common_1[_0x1c1d5b(0x14a)][_0x1c1d5b(0x12f)]);const _0x59bd93=await this[_0x1c1d5b(0x132)][_0x1c1d5b(0x152)]({'id':_0x223d25['id']});if(_0x59bd93[_0x1c1d5b(0x118)]>0x0)return await this[_0x1c1d5b(0x11b)](),'删除敏感词成功';else throw new common_1['HttpException'](_0x1c1d5b(0x126),common_1[_0x1c1d5b(0x14a)][_0x1c1d5b(0x12f)]);}async[_0x3d2636(0x123)](_0x1193a2){const _0x270869=_0x3d2636,{id:_0x46e5f4,word:_0x423133,status:_0x54e98e}=_0x1193a2,_0xf31f10=await this['badWordsEntity']['findOne']({'where':{'word':_0x423133}});if(_0xf31f10)throw new common_1[(_0x270869(0xec))](_0x270869(0x11e),common_1[_0x270869(0x14a)]['BAD_REQUEST']);const _0x6575a0=await this[_0x270869(0x132)]['update']({'id':_0x46e5f4},{'word':_0x423133,'status':_0x54e98e});if(_0x6575a0['affected']>0x0)return await this[_0x270869(0x11b)](),_0x270869(0x12b);else throw new common_1[(_0x270869(0xec))](_0x270869(0x140),common_1['HttpStatus'][_0x270869(0x12f)]);}async[_0x3d2636(0x144)](_0x420e3b){const _0x45b63d=_0x3d2636,{word:_0x7bc519}=_0x420e3b,_0x1a87dc=await this[_0x45b63d(0x132)][_0x45b63d(0x11a)]({'where':{'word':_0x7bc519}});if(_0x1a87dc)throw new common_1[(_0x45b63d(0xec))]('敏感词已存在,请检查您的提交信息',common_1[_0x45b63d(0x14a)][_0x45b63d(0x12f)]);return await this['badWordsEntity'][_0x45b63d(0xf3)]({'word':_0x7bc519}),await this['loadBadWords'](),_0x45b63d(0x119);}async[_0x3d2636(0x145)](_0x302e32,_0x2aa3d8,_0x518a39,_0x1ebdc4,_0x2d61ed){const _0x2cced0=_0x3d2636,_0x45c979={'userId':_0x302e32,'content':_0x2aa3d8,'words':JSON[_0x2cced0(0x13a)](_0x518a39),'typeCn':JSON[_0x2cced0(0x13a)](_0x1ebdc4),'typeOriginCn':_0x2d61ed};try{await this['userEntity']['createQueryBuilder']()[_0x2cced0(0xe6)](user_entity_1[_0x2cced0(0xe2)])[_0x2cced0(0x10e)]({'violationCount':()=>'violationCount\x20+\x201'})[_0x2cced0(0x13e)](_0x2cced0(0x139),{'userId':_0x302e32})['execute'](),await this[_0x2cced0(0x10a)]['save'](_0x45c979);}catch(_0x35545f){console['log'](_0x2cced0(0x150),_0x35545f);}}async[_0x3d2636(0xf5)](_0x109d96,_0x182ea5){const _0x47bef5=_0x3d2636,{role:_0x5d97e1}=_0x109d96[_0x47bef5(0x134)],{page:page=0x1,size:size=0xa,userId:_0x147b22,typeOriginCn:_0x1101a1}=_0x182ea5,_0xe7cccb={};_0x147b22&&(_0xe7cccb[_0x47bef5(0xf0)]=_0x147b22),_0x1101a1&&(_0xe7cccb[_0x47bef5(0xea)]=_0x1101a1);const [_0x4c7d49,_0x4ad30c]=await this[_0x47bef5(0x10a)]['findAndCount']({'where':_0xe7cccb,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x47bef5(0x142)}}),_0x67a7ee=[...new Set(_0x4c7d49['map'](_0x3c5942=>_0x3c5942[_0x47bef5(0xf0)]))],_0x421e10=await this[_0x47bef5(0x154)][_0x47bef5(0xed)]({'where':{'id':(0x0,typeorm_1['In'])(_0x67a7ee)},'select':['id','avatar','username',_0x47bef5(0x10f),'violationCount',_0x47bef5(0xf1)]});return _0x4c7d49[_0x47bef5(0x104)](_0x2ccfc8=>{const _0x1f431e=_0x47bef5,_0x2bfcab=_0x421e10[_0x1f431e(0xed)](_0x50a871=>_0x50a871['id']===_0x2ccfc8['userId']);_0x5d97e1!==_0x1f431e(0x14e)&&(_0x2bfcab[_0x1f431e(0x10f)]=(0x0,utils_1[_0x1f431e(0x136)])(_0x2bfcab['email'])),_0x2ccfc8['userInfo']=_0x2bfcab;}),{'rows':_0x4c7d49,'count':_0x4ad30c};}};BadwordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2[_0x3d2636(0x12a)])(badwords_entity_1[_0x3d2636(0xf7)])),__param(0x1,(0x0,typeorm_2[_0x3d2636(0x12a)])(violationLog_entity_1[_0x3d2636(0x115)])),__param(0x2,(0x0,typeorm_2[_0x3d2636(0x12a)])(user_entity_1['UserEntity'])),__metadata(_0x3d2636(0x14f),[typeorm_1[_0x3d2636(0xee)],typeorm_1[_0x3d2636(0xee)],typeorm_1[_0x3d2636(0xee)],globalConfig_service_1[_0x3d2636(0x133)]])],BadwordsService),exports[_0x3d2636(0x14c)]=BadwordsService;