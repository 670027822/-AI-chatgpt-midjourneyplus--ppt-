'use strict';function _0xae5a(_0x4413f3,_0x776dd8){const _0x3afdcc=_0x3afd();return _0xae5a=function(_0xae5a2f,_0x4a999e){_0xae5a2f=_0xae5a2f-0x15b;let _0x49a6f5=_0x3afdcc[_0xae5a2f];return _0x49a6f5;},_0xae5a(_0x4413f3,_0x776dd8);}const _0x50821a=_0xae5a;function _0x3afd(){const _0x1a3a9c=['./midjourney.entity','userEntity','floor','获取我得绘制列表失败','变换当前图片超时！','imagine','isVaryImage','parse','refundMjBalance','setPrompt','drawFailed','/mj/draw','UploadService','查询绘制结果失败:\x20getMessageList','uploadService','http://172.247.48.137:8000','3248824UQHwfc','width','../redisCache/redisCache.service','存储图片失败23123','400px','prompt','sendSmInteractions99','update','已经成功发送局部重绘','Vary\x20(Subtle)','/mj/submit/action','isZoomImage','MidjourneyActionEnum','userId','发送单张图片增强指令失败','role','【变体图片】当前图片已经被锁定，等待同任务完成','Repository','【绘制图片】第\x20','isArray','MidjourneyEntity','单张图片增强超时，请稍后再试！','isSaveImg','isGroup','https://discord.com/api/v9/interactions','now','stringify','save','36STnimA','count','中转通道23423-reshengch-jiance','获取任务成功\x20','mjTimeoutMs','delLog','crypto','开始轮询单张变换图片结果','findCurrentPromptResult','updateDrawStatus','开始查询单张图片增强的图片信息','非法操作！','DRAWTIMEOUT','本次图片上传耗时为','635JFDoOr','@nestjs/typeorm','__esModule','pollComparisonResultDraw2','开始查询放大图片信息','huihuaeghuoqu','删除失败！','sendSmInteractions','user','当前管理员限制单用户同时最多能执行','then','/h/','Error\x20retrieving\x20image\x20size:','getDrawActionDetailch','url6846656','发送阔图指令失败','error73536:\x20','design:paramtypes','get','getOwnPropertyDescriptor','metadata','mjcdn.aifa.ink','Zoom\x20Out\x201.5x','shibai！','updateDrawData2','checkBadWords','rres1.data34324','MidjourneyService','pollComparisonResultVary','findCurrentEnlargeImgResult','mjGuildId','WAITING','Zoom\x20Out\x202x','mjNotSaveImg','rec','mjId','对图片局部重绘变幻重生失败...','DRAWED','\x20次开始查询','findCurrentVaryImgResult','已经成功发送单张图片增强指令','fullPrompt','bindJobId','email','extractContent','获取图片列表结果失败:\x20','getMessageList','发送放大变幻重新生成指令失败','res','replace','没有查询到custom_id的值131','res2.data24','res.data','cleanQueue','function','mjProxy','filter','body12323','InjectRepository','height','ali','已经成功发送了重新生成图片指令','.md.png','HttpException','attachments','messageList','------>\x20开始上传图片！！！','mjPromptsEntity','getTime','/mj/submit/modal','@nestjs/common','pollComparisonResultReGenerate','assign','huihuaegEntity','debug','../userBalance/userBalance.service','midjourneyEntity','length','checkLimit','tishicihuoqu','tencent','data','300px','\x20次、\x20当前绘画进度为','image-size','base64','HttpStatus','TODO->存储图片失败,\x20','axios','VARIATION','?imageView2/1/w/','pollComparisonResultZoom','imageUrl','originUrl','../../common/constants/midjourney.constant','url','8154587ijmNLk','avatar','本次不存图片了','开始查询绘画结果','removeEmoji','lockPrompt','catch','对图片放大变幻重生失败...','https://discord.com/api/v9/channels/','GlobalConfigService','proxyImg','log','获取任务id失败！','已经成功发送了图片变化指令','formatCreateOrUpdateDate','变换图片获取中------>','customId','UserEntity','已经成功发送单张图片缩放指令','发送局部重绘指令失败','中转通道23423-bianti-jiance','./tishici.entity','delPrompt','label','发送阔图指令失败:\x20','官方通道38462','./../user/user.entity','5277670OExMPU','发送放大重新生成变幻指令失败:\x20','globalConfigService','cdn.discordapp.com','midjourney:getList','getMjDefaultParams','个任务','mjRateLimit','../globalConfig/globalConfig.service','test','components','oss','sendSmInteractionsch','isVariationsImage','getDrawActionDetail','findCurrentZoomImgResult','重新绘制图片超时，请稍后再试！','mjSessionId','TODO->error:\x20','toString','sendSmInteractionskt','BadwordsService','Vary\x20(Region)','对图片单张增强失败...','中转通道3432','uploadFileFromUrl','username','affected','getConfigs','post','chevereto','cosUrl','typeorm','GENERATE','take','round','__metadata','isSingleImage','开始单张图片增强第','delete','deleteDraw','发送绘图指令失败、请联系管理员检测绘画配置！','item.fileInfo574534','userId324324','default','TishiciEntity','isReGenerateImage','buttons','mjApplicationId','【重新生成图片】当前图片已经被锁定，等待同任务完成','609981oxGuqb','sleep','开始查询单张图片缩放的图片信息','sendDrawCommand','?x-oss-process=image/resize,w_','updateDrawData','/q/55','/messages?limit=50','绘画超时，请稍后再试！','getFullPrompt','当前绘画信息不存在！','formatFileInfo','mjChannelId','轮获取提示词','thumbImg','findCurrentPromptResult2','name','find','getImageSize','object','已经成功发送单张图片定向扩图','/fetch','18572qagZrK','draw','badwordsService','Vary\x20(Strong)','map','forEach','mjVersion','edited_timestamp','UPSCALE','开始比对重新绘制图片第','cosUrl4354354556','error213213','newurl8975675','getUploadType','extend122123','/mj/task/','userInfo','findCurrentReGenerateImgResult','getDrawActionDetail2','删除记录失败！','queryPrompt','Logger','arraybuffer','RedisCacheService','pollComparisonResultVariation','开始查询重复绘制的图片信息','567299jYtcyX','获取任务失败:\x20','mjProxyUrl','findOne','getHistroyMessageIds','hex','includes','mjProxyImgUrl','findCurrentVariationImgResult','addDrawQueue','random','set','userBalanceService','findAndCount','match','message_id','tishiciEntity','randomDrawId','parseProgress','放大图片超时，请稍后再试！','fileInfo','randomBytes','HuihuaegEntity','mjAuthorization','sendZoomInteractions','error:\x20','获取图片列表结果失败','12PPeBTB','drawInfo','成功请求但是获取任务id失败res','decorate','./huihuaeg.entity','error','push','BAD_REQUEST','binary','getDrawList','056','MidjourneyStatusEnum','__param','操作成功！','addDrawQueuech','5133324odytjF','UserBalanceService','没有相关任务！','当前图片不存在！','./prompt.entity','REGENERATE','../upload/upload.service','drawRes.data529','src','解析\x20extend\x20失败或访问属性出错:','redisCacheService','DRAWING','emoji','删除记录成功！','DESC','result','发送绘画指令失败详情','发送对单张图片增强指令失败:\x20','message','skip','当前图片已经放大过了！','删除成功！','pollComparisonResultUpscale','/mj/list?channel_id=','extend','fenlei','开始单张图片缩放第'];_0x3afd=function(){return _0x1a3a9c;};return _0x3afd();}(function(_0x2dfc73,_0x23729d){const _0x1d11a7=_0xae5a,_0x174abd=_0x2dfc73();while(!![]){try{const _0x1b8096=parseInt(_0x1d11a7(0x29a))/0x1+-parseInt(_0x1d11a7(0x2b5))/0x2*(-parseInt(_0x1d11a7(0x26a))/0x3)+parseInt(_0x1d11a7(0x280))/0x4*(-parseInt(_0x1d11a7(0x1bd))/0x5)+-parseInt(_0x1d11a7(0x168))/0x6+-parseInt(_0x1d11a7(0x21d))/0x7+-parseInt(_0x1d11a7(0x193))/0x8+parseInt(_0x1d11a7(0x1af))/0x9*(parseInt(_0x1d11a7(0x238))/0xa);if(_0x1b8096===_0x23729d)break;else _0x174abd['push'](_0x174abd['shift']());}catch(_0x5967a8){_0x174abd['push'](_0x174abd['shift']());}}}(_0x3afd,0xd7596));var __decorate=this&&this['__decorate']||function(_0x4ee0b3,_0x3f6931,_0x3f01e5,_0x4cf873){const _0x4fb3b8=_0xae5a;var _0x40417e=arguments['length'],_0x153d25=_0x40417e<0x3?_0x3f6931:_0x4cf873===null?_0x4cf873=Object[_0x4fb3b8(0x1d0)](_0x3f6931,_0x3f01e5):_0x4cf873,_0x300e17;if(typeof Reflect==='object'&&typeof Reflect[_0x4fb3b8(0x15c)]===_0x4fb3b8(0x1f3))_0x153d25=Reflect[_0x4fb3b8(0x15c)](_0x4ee0b3,_0x3f6931,_0x3f01e5,_0x4cf873);else{for(var _0x1ad303=_0x4ee0b3['length']-0x1;_0x1ad303>=0x0;_0x1ad303--)if(_0x300e17=_0x4ee0b3[_0x1ad303])_0x153d25=(_0x40417e<0x3?_0x300e17(_0x153d25):_0x40417e>0x3?_0x300e17(_0x3f6931,_0x3f01e5,_0x153d25):_0x300e17(_0x3f6931,_0x3f01e5))||_0x153d25;}return _0x40417e>0x3&&_0x153d25&&Object['defineProperty'](_0x3f6931,_0x3f01e5,_0x153d25),_0x153d25;},__metadata=this&&this[_0x50821a(0x25c)]||function(_0x4649dd,_0x7576ee){const _0x3686da=_0x50821a;if(typeof Reflect===_0x3686da(0x27d)&&typeof Reflect[_0x3686da(0x1d1)]==='function')return Reflect[_0x3686da(0x1d1)](_0x4649dd,_0x7576ee);},__param=this&&this[_0x50821a(0x165)]||function(_0x1c8e0e,_0x1cd5b0){return function(_0x2e696e,_0x2e3c3c){_0x1cd5b0(_0x2e696e,_0x2e3c3c,_0x1c8e0e);};};Object['defineProperty'](exports,_0x50821a(0x1bf),{'value':!![]}),exports['MidjourneyService']=void 0x0;const user_entity_1=require(_0x50821a(0x237)),common_1=require(_0x50821a(0x203)),typeorm_1=require(_0x50821a(0x1be)),midjourney_entity_1=require(_0x50821a(0x183)),tishici_entity_1=require(_0x50821a(0x232)),typeorm_2=require(_0x50821a(0x258)),axios_1=require(_0x50821a(0x215)),globalConfig_service_1=require(_0x50821a(0x240)),midjourney_constant_1=require(_0x50821a(0x21b)),upload_service_1=require(_0x50821a(0x16e)),badwords_service_1=require('../badwords/badwords.service'),userBalance_service_1=require(_0x50821a(0x208)),utils_1=require('../../common/utils'),redisCache_service_1=require(_0x50821a(0x195)),prompt_entity_1=require(_0x50821a(0x16c)),huihuaeg_entity_1=require(_0x50821a(0x15d)),imageSize=require(_0x50821a(0x211));let MidjourneyService=class MidjourneyService{constructor(_0x4ec873,_0x5909ed,_0x2303ce,_0x2e6cc4,_0x162247,_0x3c6591,_0xc5c91e,_0x298eb2,_0x4d3631,_0x5e1ded){const _0x1241b7=_0x50821a;this[_0x1241b7(0x209)]=_0x4ec873,this[_0x1241b7(0x2aa)]=_0x5909ed,this[_0x1241b7(0x206)]=_0x2303ce,this[_0x1241b7(0x184)]=_0x2e6cc4,this[_0x1241b7(0x200)]=_0x162247,this['globalConfigService']=_0x3c6591,this[_0x1241b7(0x191)]=_0xc5c91e,this['badwordsService']=_0x298eb2,this[_0x1241b7(0x2a6)]=_0x4d3631,this['redisCacheService']=_0x5e1ded,this[_0x1241b7(0x222)]=[];}async[_0x50821a(0x20c)](_0x5a5813){const _0x55de37=_0x50821a;console[_0x55de37(0x228)]('params54767',_0x5a5813);const _0x55c472=await this[_0x55de37(0x2aa)][_0x55de37(0x27b)]({'select':['id',_0x55de37(0x27a),_0x55de37(0x181),'src'],'where':{'fenlei':_0x5a5813['fenlei']},'skip':_0x5a5813[_0x55de37(0x17b)],'take':_0x5a5813[_0x55de37(0x25a)]});return console['log']('这是第'+_0x5a5813[_0x55de37(0x17b)]+_0x55de37(0x277)),_0x55c472;}async[_0x50821a(0x1c2)](){const _0x1d71b8=_0x50821a,_0xc205fd=await this[_0x1d71b8(0x206)][_0x1d71b8(0x27b)]({'select':['id',_0x1d71b8(0x27a),_0x1d71b8(0x198),_0x1d71b8(0x170)]});return _0xc205fd;}async[_0x50821a(0x26b)](_0x4e42aa){return new Promise(_0x7b67f6=>setTimeout(_0x7b67f6,_0x4e42aa));}async[_0x50821a(0x281)](_0x38c644,_0x391513){const _0x27cd58=_0x50821a,{id:_0x175b98,action:_0x12ba3a}=_0x38c644,_0x381d88=await this[_0x27cd58(0x209)]['findOne']({'where':{'id':_0x175b98}}),{channel_id:_0xd4431,mjProxy:_0x1861cf}=await this[_0x27cd58(0x23d)]();try{await this[_0x27cd58(0x1e7)](_0x175b98,_0x391513),await this[_0x27cd58(0x1b8)](_0x175b98,midjourney_constant_1[_0x27cd58(0x164)][_0x27cd58(0x173)]);if(_0x12ba3a===midjourney_constant_1['MidjourneyActionEnum']['DRAW']||_0x12ba3a===midjourney_constant_1[_0x27cd58(0x19f)][_0x27cd58(0x259)]){const _0x1ad9e7=await this[_0x27cd58(0x26d)](_0x381d88,_0x38c644);console[_0x27cd58(0x228)](_0x27cd58(0x163),_0x1ad9e7);if(_0xd4431==='0'){console[_0x27cd58(0x228)](_0x27cd58(0x250));const _0x8ca736=await this[_0x27cd58(0x1c0)](_0x381d88,_0x1ad9e7[_0x27cd58(0x20e)]);await this[_0x27cd58(0x1d5)](_0x38c644,_0x8ca736);}else{console[_0x27cd58(0x228)](_0x27cd58(0x236));const _0x3790d9=await this['pollComparisonResultDraw'](_0x381d88);await this[_0x27cd58(0x26f)](_0x38c644,_0x3790d9);}}if(_0x12ba3a===midjourney_constant_1['MidjourneyActionEnum'][_0x27cd58(0x288)]){const {message_id:_0x13d30b,custom_id:_0xa91fee,orderId:_0xc573af,extend:_0x1f53eb}=_0x381d88,_0xb0d47b=await this[_0x27cd58(0x1c4)]({'message_id':_0x13d30b,'custom_id':_0xa91fee,'orderId':_0xc573af,'extend':_0x1f53eb},_0x38c644);common_1[_0x27cd58(0x295)][_0x27cd58(0x207)]('记录'+_0x175b98+'已经成功发送了图片放大指令',_0x27cd58(0x1d8)),console[_0x27cd58(0x228)]('中转通道23423-fangda');const _0x49ea75=await this[_0x27cd58(0x1c0)](_0x381d88,_0xb0d47b['data']);await this[_0x27cd58(0x1d5)](_0x38c644,_0x49ea75);}if(_0x12ba3a===midjourney_constant_1['MidjourneyActionEnum'][_0x27cd58(0x216)]){const {message_id:_0x36549b,custom_id:_0x3609c9,orderId:_0x4a8e66,extend:_0x1e23e1}=_0x381d88,_0x5d5bf7=await this[_0x27cd58(0x1c4)]({'message_id':_0x36549b,'custom_id':_0x3609c9,'orderId':_0x4a8e66,'extend':_0x1e23e1},_0x38c644);common_1[_0x27cd58(0x295)][_0x27cd58(0x207)]('记录'+_0x175b98+_0x27cd58(0x22a),_0x27cd58(0x1d8)),console[_0x27cd58(0x228)](_0x27cd58(0x231));const _0x383b45=await this['pollComparisonResultDraw2'](_0x381d88,_0x5d5bf7['data']);await this[_0x27cd58(0x1d5)](_0x38c644,_0x383b45);}if(_0x12ba3a===midjourney_constant_1[_0x27cd58(0x19f)][_0x27cd58(0x16d)]){const {message_id:_0x2b7bde,custom_id:_0x151f54,orderId:orderId=0x5,extend:_0xcbf3d1}=_0x381d88,_0x55db3a=await this[_0x27cd58(0x199)]({'message_id':_0x2b7bde,'custom_id':_0x151f54,'orderId':orderId,'extend':_0xcbf3d1},_0x38c644);common_1[_0x27cd58(0x295)][_0x27cd58(0x207)]('记录'+_0x175b98+_0x27cd58(0x1fa),_0x27cd58(0x1d8)),console[_0x27cd58(0x228)](_0x27cd58(0x1b1));const _0x1b8d10=await this[_0x27cd58(0x1c0)](_0x381d88,_0x55db3a[_0x27cd58(0x20e)]);await this[_0x27cd58(0x1d5)](_0x38c644,_0x1b8d10);}if(_0x12ba3a===0x7||_0x12ba3a===0x8){const {message_id:_0x5ea7f6,custom_id:_0x3d80ca,orderId:orderId=0x5,extend:_0x23a74e}=_0x381d88,_0x1d2f29=await this[_0x27cd58(0x199)]({'message_id':_0x5ea7f6,'custom_id':_0x3d80ca,'orderId':orderId,'extend':_0x23a74e},_0x38c644);common_1[_0x27cd58(0x295)][_0x27cd58(0x207)]('记录'+_0x175b98+_0x27cd58(0x1e5),'MidjourneyService');const _0x1902b1=await this[_0x27cd58(0x1c0)](_0x381d88,_0x1d2f29[_0x27cd58(0x20e)]);await this[_0x27cd58(0x1d5)](_0x38c644,_0x1902b1);}if(_0x12ba3a===0x6||_0x12ba3a===0x9){const {message_id:_0x2fef03,custom_id:_0x248a1e,orderId:orderId=0x5,extend:_0x3b3b75}=_0x381d88,_0x67e439=await this[_0x27cd58(0x199)]({'message_id':_0x2fef03,'custom_id':_0x248a1e,'orderId':orderId,'extend':_0x3b3b75},_0x38c644);common_1[_0x27cd58(0x295)]['debug']('记录'+_0x175b98+_0x27cd58(0x22f),'MidjourneyService');const _0x993923=await this[_0x27cd58(0x1c0)](_0x381d88,_0x67e439[_0x27cd58(0x20e)]);await this[_0x27cd58(0x1d5)](_0x38c644,_0x993923);};if(_0x12ba3a===0xa||_0x12ba3a===0xb||_0x12ba3a===0xc||_0x12ba3a===0xd){const {message_id:_0x34e6da,custom_id:_0x599a77,orderId:orderId=0x5,extend:_0x54df1e}=_0x381d88,_0x46f775=await this[_0x27cd58(0x24c)]({'message_id':_0x34e6da,'custom_id':_0x599a77,'orderId':orderId,'extend':_0x54df1e},_0x38c644);common_1[_0x27cd58(0x295)][_0x27cd58(0x207)]('记录'+_0x175b98+_0x27cd58(0x27e),_0x27cd58(0x1d8));const _0x2c459b=await this[_0x27cd58(0x1c0)](_0x381d88,_0x46f775['data']);await this[_0x27cd58(0x1d5)](_0x38c644,_0x2c459b);};if(_0x12ba3a===0xf){const {imgUrl:_0x2394d7,prompt:_0x203e64,custom_id:_0x4e5e2a,extend:_0xf9eb7}=_0x381d88,_0x42f8d3=await this[_0x27cd58(0x244)]({'custom_id':_0x4e5e2a,'extend':_0xf9eb7,'imgUrl':_0x2394d7,'prompt':_0x203e64},_0x38c644);common_1[_0x27cd58(0x295)]['debug']('记录'+_0x175b98+_0x27cd58(0x19b),_0x27cd58(0x1d8));const _0x16a06e=await this[_0x27cd58(0x1c0)](_0x381d88,_0x42f8d3[_0x27cd58(0x20e)]);await this[_0x27cd58(0x1d5)](_0x38c644,_0x16a06e);};return!![];}catch(_0x10fedd){return this['lockPrompt']=this[_0x27cd58(0x222)][_0x27cd58(0x1f5)](_0x14442d=>_0x14442d!==_0x381d88['randomDrawId']),console['log']('2432434'),await this[_0x27cd58(0x18d)](_0x38c644),console[_0x27cd58(0x228)](_0x27cd58(0x1cd),_0x10fedd),!![];}}async[_0x50821a(0x2a3)](_0x2ae29f){const _0x48925e=_0x50821a,{prompt:_0x1bc4d2,imgUrl:imgUrl='',extraParam:extraParam='',action:action=0x1,userId:_0xfa6b7c,randomDrawId:_0x47d38e,orderId:orderId=0x0,custom_id:_0x1e4c5d,message_id:_0x1bd092,drawId:_0x2383a2,extend:_0x489ee0,gk:_0x2144bb}=_0x2ae29f,_0x5668ab=imgUrl?imgUrl+'\x20'+_0x1bc4d2+'\x20'+extraParam:_0x1bc4d2+'\x20'+extraParam;await this[_0x48925e(0x282)][_0x48925e(0x1d6)](_0x5668ab,_0xfa6b7c);const _0x4700b1={'userId':_0xfa6b7c,'extraParam':extraParam,'prompt':_0x1bc4d2,'imgUrl':imgUrl,'fullPrompt':_0x5668ab,'randomDrawId':_0x47d38e,'status':midjourney_constant_1['MidjourneyStatusEnum'][_0x48925e(0x1dc)],'action':action,'orderId':orderId,'custom_id':_0x1e4c5d,'message_id':_0x1bd092,'extend':_0x489ee0,'gk':_0x2144bb},_0x4685d7=await this[_0x48925e(0x209)][_0x48925e(0x1ae)](_0x4700b1);return _0x4685d7;}async[_0x50821a(0x167)](_0x60f76){const _0x227ea9=_0x50821a,{prompt:_0x5ca456,maskBase64:_0x15cf60,extraParam:extraParam='',action:action=0x1,userId:_0x5e701b,randomDrawId:_0x4616e2,orderId:orderId=0x0,custom_id:_0x1d9ede,message_id:_0x56d0f4,drawId:_0x4ab598,extend:_0x2bbc63}=_0x60f76,_0x20ebdd=_0x5ca456+'\x20'+extraParam;await this['badwordsService'][_0x227ea9(0x1d6)](_0x20ebdd,_0x5e701b);const _0x15c535={'userId':_0x5e701b,'extraParam':extraParam,'prompt':_0x5ca456,'imgUrl':_0x15cf60,'fullPrompt':_0x20ebdd,'randomDrawId':_0x4616e2,'status':midjourney_constant_1['MidjourneyStatusEnum']['WAITING'],'action':action,'orderId':orderId,'custom_id':_0x1d9ede,'message_id':_0x56d0f4,'extend':_0x2bbc63};try{const _0x4e38c5=await this['midjourneyEntity'][_0x227ea9(0x1ae)](_0x15c535);return console[_0x227ea9(0x228)](0xe17ac4f),_0x4e38c5;}catch(_0x3c84eb){console['log']('error34234234',_0x3c84eb);}}async[_0x50821a(0x1b8)](_0x1834c6,_0x4ae55c){const _0x3b1013=_0x50821a;await this['midjourneyEntity'][_0x3b1013(0x19a)]({'id':_0x1834c6},{'status':_0x4ae55c});}async[_0x50821a(0x26f)](_0x54c4fc,_0x2dd3e5){const _0x690b0e=_0x50821a;try{const {id:_0x17e5a0,content:_0x5e02a8,channel_id:_0x43673c,attachments:attachments=[],timestamp:_0x420ada,durationSpent:_0x7a4aa}=_0x2dd3e5,{filename:_0x199b63,url:_0x2a00ef,proxy_url:_0x5adef8,width:_0x492673,height:_0x33dfe6,size:_0xc154e2}=attachments[0x0],_0x45d471=await this[_0x690b0e(0x23a)][_0x690b0e(0x254)]([_0x690b0e(0x1de)]);let _0x550e0e='';if(!Number(_0x45d471)||Number(_0x45d471)===0x0){common_1[_0x690b0e(0x295)][_0x690b0e(0x207)](_0x690b0e(0x1ff),_0x690b0e(0x1d8));const _0x2bb457=new Date();_0x550e0e=await this[_0x690b0e(0x191)][_0x690b0e(0x251)]({'filename':_0x199b63,'url':_0x2a00ef});const _0x5b3fc4=new Date();common_1['Logger'][_0x690b0e(0x207)]('本次图片上传耗时为'+(_0x5b3fc4[_0x690b0e(0x201)]()-_0x2bb457[_0x690b0e(0x201)]())/0x3e8+'秒',_0x690b0e(0x1d8));}else console[_0x690b0e(0x228)]('本次不存图片了');const _0x5e95eb=await this['uploadService']['getUploadType'](),_0x341bb9={'status':midjourney_constant_1['MidjourneyStatusEnum']['DRAWED'],'message_id':_0x17e5a0,'progress':0x64,'fileInfo':JSON[_0x690b0e(0x1ad)]({'width':_0x492673,'height':_0x33dfe6,'size':_0xc154e2,'filename':_0x199b63,'cosUrl':_0x550e0e,'cosType':_0x5e95eb}),'extend':this['removeEmoji'](JSON[_0x690b0e(0x1ad)](_0x2dd3e5)),'durationSpent':_0x7a4aa,'isSaveImg':!Number(_0x45d471)||Number(_0x45d471)===0x0};await this[_0x690b0e(0x209)][_0x690b0e(0x19a)]({'id':_0x54c4fc['id']},_0x341bb9);}catch(_0x497dfc){console[_0x690b0e(0x228)](_0x690b0e(0x214),_0x54c4fc,_0x497dfc);}}async['generateRandomFilename'](){const _0x20bf24=_0x50821a,_0xbc39=require(_0x20bf24(0x1b5)),_0x9f9c05=_0xbc39[_0x20bf24(0x2af)](0x20),_0x4b6f13=_0x9f9c05[_0x20bf24(0x24b)](_0x20bf24(0x29f)),_0x3b280b=_0x4b6f13+'.png';return _0x3b280b;}async['getImageSize'](_0x131943){const _0x38eab8=_0x50821a;try{const _0x118b95=await(0x0,axios_1['default'])({'method':_0x38eab8(0x1cf),'url':_0x131943,'responseType':'arraybuffer'}),_0x405cd8=Buffer['from'](_0x118b95[_0x38eab8(0x20e)],_0x38eab8(0x161)),_0xa9ccee=imageSize(_0x405cd8),_0x4d667a=_0xa9ccee[_0x38eab8(0x194)],_0x580ddf=_0xa9ccee['height'];return{'width':_0x4d667a,'height':_0x580ddf};}catch(_0x1809a3){return console['error'](_0x38eab8(0x1c9),_0x1809a3),null;}}async['updateDrawData2'](_0x33463b,_0x9b80be){const _0x7b1f6=_0x50821a;try{const _0x2c117f=_0x9b80be[_0x7b1f6(0x20e)][_0x7b1f6(0x219)],_0x3653e2=_0x7b1f6(0x1d2),_0x318a7c=_0x2c117f[_0x7b1f6(0x1ee)](_0x7b1f6(0x23b),_0x3653e2);console[_0x7b1f6(0x228)](_0x7b1f6(0x1cb),_0x2c117f),console[_0x7b1f6(0x228)](_0x7b1f6(0x28c),_0x318a7c);const _0x26928c=_0x9b80be['data']['id'],_0x4ead22=await this['generateRandomFilename'](),_0x153818=await this['globalConfigService'][_0x7b1f6(0x254)]([_0x7b1f6(0x1de)]);let _0x2a5831='';if(!Number(_0x153818)||Number(_0x153818)===0x0)try{common_1[_0x7b1f6(0x295)][_0x7b1f6(0x207)]('------>\x20（中转路径）开始上传图片！！！','MidjourneyService');const _0x513537=new Date();_0x2a5831=await this['uploadService'][_0x7b1f6(0x251)]({'filename':_0x4ead22,'url':_0x318a7c});const _0x480e26=new Date();common_1[_0x7b1f6(0x295)]['debug'](_0x7b1f6(0x1bc)+(_0x480e26[_0x7b1f6(0x201)]()-_0x513537[_0x7b1f6(0x201)]())/0x3e8+'秒',_0x7b1f6(0x1d8));}catch(_0x529d06){throw new common_1['HttpException'](_0x7b1f6(0x196),_0x529d06);}else console['log'](_0x7b1f6(0x21f)),_0x2a5831=_0x318a7c,console[_0x7b1f6(0x228)](_0x7b1f6(0x28a),_0x2a5831);const _0xa9128=await this[_0x7b1f6(0x191)][_0x7b1f6(0x28d)]();let _0x348481=_0x7b1f6(0x20f),_0x4c194e=_0x7b1f6(0x197);await this[_0x7b1f6(0x27c)](_0x2a5831)[_0x7b1f6(0x1c7)](_0x37941c=>{const _0x2e3fd6=_0x7b1f6;_0x37941c&&(_0x348481=_0x37941c[_0x2e3fd6(0x194)],_0x4c194e=_0x37941c[_0x2e3fd6(0x1f8)]);})[_0x7b1f6(0x223)](_0x1e9535=>{const _0x4dbf4b=_0x7b1f6;console[_0x4dbf4b(0x15e)](_0x1e9535);});const _0x5553db=0x2,_0x1f3e10={'status':midjourney_constant_1[_0x7b1f6(0x164)]['DRAWED'],'progress':0x64,'fileInfo':JSON['stringify']({'width':_0x348481,'height':_0x4c194e,'size':_0x5553db,'filename':_0x4ead22,'cosUrl':_0x2a5831,'cosType':_0xa9128}),'extend':this['removeEmoji'](JSON[_0x7b1f6(0x1ad)](_0x9b80be[_0x7b1f6(0x20e)])),'isSaveImg':!Number(_0x153818)||Number(_0x153818)===0x0,'custom_id':_0x26928c};await this[_0x7b1f6(0x209)]['update']({'id':_0x33463b['id']},_0x1f3e10);}catch(_0x512eec){console[_0x7b1f6(0x228)](_0x7b1f6(0x214),_0x33463b,_0x512eec);throw new common_1[(_0x7b1f6(0x1fc))](_0x7b1f6(0x1d4),common_1[_0x7b1f6(0x213)][_0x7b1f6(0x160)]);}}async[_0x50821a(0x29e)](_0x162855){const _0x3400b8=_0x50821a,_0x328928=await this[_0x3400b8(0x209)]['find']({'where':{'randomDrawId':_0x162855,'status':midjourney_constant_1[_0x3400b8(0x164)][_0x3400b8(0x1e2)]}});return _0x328928['map'](_0x1f0392=>_0x1f0392[_0x3400b8(0x2a9)]);}async[_0x50821a(0x26d)](_0x4a0693,_0x5a3f75){const _0x4fddde=_0x50821a,{fullPrompt:_0x5e12a1,randomDrawId:_0x1e0aee,imgUrl:_0xf8d56b}=_0x4a0693,_0x418050=_0xf8d56b?_0xf8d56b+'\x20'+_0x5e12a1:''+_0x5e12a1;common_1[_0x4fddde(0x295)]['debug']('本次绘图指令为'+_0x418050,_0x4fddde(0x1d8));const {application_id:_0x1ec36c,guild_id:_0x5eb440,channel_id:_0x1d1c33,session_id:_0x4dc791,version:_0x122941,id:_0x1a3768,authorization:_0x388f60,mjProxy:_0x5b2b3c}=await this[_0x4fddde(0x23d)](),_0x2b1c4d={'type':0x2,'application_id':_0x1ec36c,'guild_id':_0x5eb440,'channel_id':_0x1d1c33,'session_id':_0x4dc791,'data':{'version':_0x122941,'id':_0x1a3768,'name':_0x4fddde(0x188),'type':0x1,'options':[{'type':0x3,'name':_0x4fddde(0x198),'value':_0x418050}],'attachments':[]}},_0x29cdf2={'prompt':_0x418050,'base64Array':[],'notifyHook':'','state':''};try{const _0x32ba33=await this[_0x4fddde(0x23a)]['getConfigs']([_0x4fddde(0x29c)])||_0x4fddde(0x192),_0x8eca1f=_0x32ba33+'/mj/submit/imagine',_0x44469d=_0x4fddde(0x1ab),_0x273826={'authorization':_0x388f60},_0x265beb={'mj-api-secret':_0x388f60,'Authorization':_0x388f60};if(_0x1d1c33==='0'){const _0x1c4508=await axios_1['default']['post'](_0x8eca1f,_0x29cdf2,{'headers':_0x265beb});if(_0x1c4508['data'][_0x4fddde(0x177)])return console[_0x4fddde(0x228)]('res.data23213',_0x1c4508[_0x4fddde(0x20e)]),_0x1c4508;else{console[_0x4fddde(0x228)](_0x4fddde(0x1f1),_0x1c4508['data']);throw new common_1[(_0x4fddde(0x1fc))](_0x4fddde(0x15b),_0x1c4508[_0x4fddde(0x20e)]);}}else{const _0x525987=await axios_1[_0x4fddde(0x264)][_0x4fddde(0x255)](_0x44469d,_0x2b1c4d,{'headers':_0x273826});if(_0x525987[_0x4fddde(0x20e)][_0x4fddde(0x177)])return _0x525987;else{console[_0x4fddde(0x228)](_0x4fddde(0x1f1),_0x525987[_0x4fddde(0x20e)]);throw new common_1[(_0x4fddde(0x1fc))](_0x4fddde(0x15b),_0x525987[_0x4fddde(0x20e)]);}}}catch(_0x3403ab){common_1['Logger'][_0x4fddde(0x15e)]('发送绘画指令失败',_0x4fddde(0x1d8)),common_1[_0x4fddde(0x295)][_0x4fddde(0x15e)](_0x4fddde(0x178),_0x3403ab);throw new common_1[(_0x4fddde(0x1fc))](_0x4fddde(0x261),common_1[_0x4fddde(0x213)][_0x4fddde(0x160)]);}}async[_0x50821a(0x1c4)](_0x30fcb3,_0xed1def){const _0x1b5019=_0x50821a,{message_id:_0x930921,custom_id:custom_id=0x0,orderId:orderId=0x0,extend:_0xb356f0}=_0x30fcb3,{application_id:_0x1d201c,guild_id:_0x908b3b,channel_id:_0x1fdaf0,session_id:_0x8c402b,version:_0x257811,id:_0x39351b,authorization:_0x151822,mjProxy:_0x546b4f}=await this[_0x1b5019(0x23d)](),_0x5414fb=await this[_0x1b5019(0x23a)][_0x1b5019(0x254)]([_0x1b5019(0x29c)])||_0x1b5019(0x192),_0x355629=_0x546b4f==0x1?_0x5414fb+'/mj/submit/action':_0x1b5019(0x1ab),{action:action=0x1}=_0xed1def,_0x21b7b1=JSON['parse'](_0xb356f0),_0x147372=_0x21b7b1[_0x1b5019(0x267)];let _0x267df1=null,_0x5260eb=null;if(action===0x2&&orderId===0x1)_0x5260eb='U1';else{if(action===0x2&&orderId===0x2)_0x5260eb='U2';else{if(action===0x2&&orderId===0x3)_0x5260eb='U3';else{if(action===0x2&&orderId===0x4)_0x5260eb='U4';else{if(action===0x3&&orderId===0x1)_0x5260eb='V1';else{if(action===0x3&&orderId===0x2)_0x5260eb='V2';else{if(action===0x3&&orderId===0x3)_0x5260eb='V3';else action===0x3&&orderId===0x4&&(_0x5260eb='V4');}}}}}};let _0x13a465=_0x147372[_0x1b5019(0x27b)](_0x51c686=>_0x51c686[_0x1b5019(0x234)]===_0x5260eb);_0x267df1=_0x13a465?_0x13a465[_0x1b5019(0x22d)]:null;const _0x34c394={'mj-api-secret':_0x151822,'Authorization':_0x151822},_0x51cb83={'customId':_0x267df1,'taskId':custom_id};try{console[_0x1b5019(0x228)]('bfangda2323',_0x51cb83);const _0x483f6b=await axios_1[_0x1b5019(0x264)][_0x1b5019(0x255)](_0x355629,_0x51cb83,{'headers':_0x34c394});return _0x483f6b;}catch(_0x242ca0){console[_0x1b5019(0x228)](_0x1b5019(0x239),_0x242ca0),common_1[_0x1b5019(0x295)][_0x1b5019(0x15e)]('发送放大变幻重新生成指令失败',_0x1b5019(0x1d8));throw new common_1['HttpException']('对图片放大变幻重生失败...',common_1[_0x1b5019(0x213)][_0x1b5019(0x160)]);}}async[_0x50821a(0x199)](_0x25f13e,_0x3f3e48){const _0x4e0ace=_0x50821a,{message_id:_0x107a00,custom_id:custom_id=0x0,orderId:orderId=0x0,extend:_0x4dbbb7}=_0x25f13e,{application_id:_0x434bf0,guild_id:_0x441188,channel_id:_0x4aa994,session_id:_0xc82560,version:_0x3d530e,id:_0x5e8553,authorization:_0x5791f4,mjProxy:_0x5a56d3}=await this[_0x4e0ace(0x23d)](),_0x4d0462=await this['globalConfigService'][_0x4e0ace(0x254)]([_0x4e0ace(0x29c)])||_0x4e0ace(0x192),_0x86cc94=_0x5a56d3==0x1?_0x4d0462+_0x4e0ace(0x19d):_0x4e0ace(0x1ab),{action:action=0x1}=_0x3f3e48,_0x3efd69=JSON[_0x4e0ace(0x18a)](_0x4dbbb7),_0x521e64=_0x3efd69[_0x4e0ace(0x267)];let _0x48ffaa=null,_0x33125d=null,_0x15db2d=null;if(action===0x5)_0x15db2d='';else{if(action===0x6)_0x15db2d=_0x4e0ace(0x1d3);else{if(action===0x9)_0x15db2d=_0x4e0ace(0x1dd);else{if(action===0x7)_0x15db2d=_0x4e0ace(0x19c);else action===0x8&&(_0x15db2d=_0x4e0ace(0x283));}}};let _0x405272=_0x521e64[_0x4e0ace(0x27b)](_0xb8dfbb=>_0xb8dfbb[_0x4e0ace(0x234)]===_0x15db2d);_0x33125d=_0x405272?_0x405272['customId']:null;const _0x40071b={'mj-api-secret':_0x5791f4,'Authorization':_0x5791f4},_0x99f65e={'customId':_0x33125d,'taskId':custom_id};try{if(_0x33125d){const _0x120263=await axios_1[_0x4e0ace(0x264)][_0x4e0ace(0x255)](_0x86cc94,_0x99f65e,{'headers':_0x40071b});return _0x120263;}else throw new common_1[(_0x4e0ace(0x1fc))](_0x4e0ace(0x1ef),common_1[_0x4e0ace(0x213)][_0x4e0ace(0x160)]);;}catch(_0x497864){console[_0x4e0ace(0x228)](_0x4e0ace(0x239),_0x497864),common_1[_0x4e0ace(0x295)]['error'](_0x4e0ace(0x1ec),_0x4e0ace(0x1d8));throw new common_1[(_0x4e0ace(0x1fc))](_0x4e0ace(0x224),common_1[_0x4e0ace(0x213)][_0x4e0ace(0x160)]);}}async[_0x50821a(0x244)](_0x491107,_0xbd9c79){const _0xc15332=_0x50821a,{custom_id:custom_id=0x0,extend:_0x5c72de,imgUrl:_0x37b176,prompt:_0x11eb21}=_0x491107,{application_id:_0x5cf4b5,guild_id:_0x160517,channel_id:_0x41d2f0,session_id:_0x38a5bc,version:_0x52c6d9,id:_0x5e7ac6,authorization:_0x51393a,mjProxy:_0x2cc3e2}=await this[_0xc15332(0x23d)](),_0x3f06ca=await this['globalConfigService'][_0xc15332(0x254)]([_0xc15332(0x29c)])||'http://172.247.48.137:8000',_0x2df0aa=_0x2cc3e2==0x1?_0x3f06ca+_0xc15332(0x19d):_0xc15332(0x1ab),_0x4b6a1b=_0x2cc3e2==0x1?_0x3f06ca+_0xc15332(0x202):_0xc15332(0x1ab),{action:action=0x1}=_0xbd9c79,_0x1c99ca=JSON['parse'](_0x5c72de),_0x5ebbbd=_0x1c99ca[_0xc15332(0x267)];let _0x563686=null,_0x374898=null;action===0xf&&(_0x374898=_0xc15332(0x24e));;let _0x172fed=_0x5ebbbd['find'](_0x14bbcb=>_0x14bbcb['label']===_0x374898);_0x563686=_0x172fed?_0x172fed[_0xc15332(0x22d)]:null;const _0x3e836b={'mj-api-secret':_0x51393a,'Authorization':_0x51393a},_0x22af08={'taskId':custom_id,'customId':_0x563686};console[_0xc15332(0x228)](_0xc15332(0x1f6),_0x22af08);try{if(_0x563686){const _0x46b25e=await axios_1[_0xc15332(0x264)][_0xc15332(0x255)](_0x2df0aa,_0x22af08,{'headers':_0x3e836b,'maxContentLength':Infinity});console['log'](_0xc15332(0x1d7),_0x46b25e['data']);if(_0x46b25e[_0xc15332(0x20e)][_0xc15332(0x177)]){const _0x42605b={'prompt':_0x11eb21,'taskId':_0x46b25e[_0xc15332(0x20e)][_0xc15332(0x177)],'maskBase64':_0x37b176};console[_0xc15332(0x228)]('body2-2343242',_0x42605b);const _0x44d58b=await axios_1[_0xc15332(0x264)][_0xc15332(0x255)](_0x4b6a1b,_0x42605b,{'headers':_0x3e836b});return console['log'](_0xc15332(0x1f0),_0x44d58b['data']),_0x44d58b;}else throw new common_1[(_0xc15332(0x1fc))](_0xc15332(0x1ef),common_1[_0xc15332(0x213)][_0xc15332(0x160)]);}else throw new common_1['HttpException'](_0xc15332(0x1ef),common_1[_0xc15332(0x213)][_0xc15332(0x160)]);;}catch(_0x242ebb){console[_0xc15332(0x228)]('发送局部重绘指令失败32423:\x20',_0x242ebb),common_1[_0xc15332(0x295)][_0xc15332(0x15e)](_0xc15332(0x230),_0xc15332(0x1d8));throw new common_1['HttpException'](_0xc15332(0x1e1),common_1[_0xc15332(0x213)][_0xc15332(0x160)]);}}async['sendSmInteractionskt'](_0xaa6c08,_0x5f5262){const _0x24a917=_0x50821a,{message_id:_0x26e290,custom_id:custom_id=0x0,orderId:orderId=0x0,extend:_0x3dd392}=_0xaa6c08,{application_id:_0x8211ed,guild_id:_0x1a9692,channel_id:_0x3afa7b,session_id:_0x4e142c,version:_0x6ae04b,id:_0x55183b,authorization:_0x578260,mjProxy:_0x2d0a0d}=await this['getMjDefaultParams'](),_0x34a7ce=await this['globalConfigService'][_0x24a917(0x254)]([_0x24a917(0x29c)])||_0x24a917(0x192),_0xe927e1=_0x2d0a0d==0x1?_0x34a7ce+_0x24a917(0x19d):_0x24a917(0x1ab),{action:action=0x1}=_0x5f5262,_0x364911=JSON[_0x24a917(0x18a)](_0x3dd392);console['log'](_0x24a917(0x28e),_0x3dd392);const _0x370d2c=_0x364911[_0x24a917(0x267)];let _0x2069aa=null,_0x30a152=null;if(action===0x5)_0x30a152='';else{if(action===0xa)_0x30a152='⬅️';else{if(action===0xb)_0x30a152='➡️';else{if(action===0xc)_0x30a152='⬆️';else action===0xd&&(_0x30a152='⬇️');}}};let _0x702d73=_0x370d2c[_0x24a917(0x27b)](_0x4ea72f=>_0x4ea72f[_0x24a917(0x174)]===_0x30a152);_0x2069aa=_0x702d73?_0x702d73[_0x24a917(0x22d)]:null;const _0x56226a={'mj-api-secret':_0x578260,'Authorization':_0x578260},_0x49362e={'customId':_0x2069aa,'taskId':custom_id};try{if(_0x2069aa){const _0x2ec6c5=await axios_1[_0x24a917(0x264)][_0x24a917(0x255)](_0xe927e1,_0x49362e,{'headers':_0x56226a});return _0x2ec6c5;}else throw new common_1[(_0x24a917(0x1fc))]('没有查询到custom_id的值131',common_1[_0x24a917(0x213)][_0x24a917(0x160)]);;}catch(_0x4de5e7){console['log'](_0x24a917(0x235),_0x4de5e7),common_1['Logger'][_0x24a917(0x15e)](_0x24a917(0x1cc),_0x24a917(0x1d8));throw new common_1[(_0x24a917(0x1fc))]('对图片扩展失败...',common_1[_0x24a917(0x213)]['BAD_REQUEST']);}}async['sendVaryInteractions'](_0xd01319,_0x59ff31){const _0x9a6b23=_0x50821a,{message_id:_0x53937a,custom_id:_0x104527}=_0xd01319,{application_id:_0x53ea92,guild_id:_0x19c0d0,channel_id:_0xa4ab9c,session_id:_0x5746e3,version:_0x2a1420,id:_0xdcc4e5,authorization:_0xdf4e67,mjProxy:_0x58f890}=await this[_0x9a6b23(0x23d)](),_0x34da47=await this[_0x9a6b23(0x23a)][_0x9a6b23(0x254)]([_0x9a6b23(0x29c)])||_0x9a6b23(0x192),_0x1626c5=_0x58f890==0x1?_0x34da47+_0x9a6b23(0x18e):_0x9a6b23(0x1ab),_0x3a0640={'authorization':_0xdf4e67},_0x640a51={'type':0x3,'guild_id':_0x19c0d0,'channel_id':_0xa4ab9c,'message_id':_0x53937a,'application_id':_0x53ea92,'session_id':_0x5746e3,'data':{'component_type':0x2,'custom_id':_0x104527}};try{await axios_1['default'][_0x9a6b23(0x255)](_0x1626c5,_0x640a51,{'headers':_0x3a0640});}catch(_0x2e385e){console[_0x9a6b23(0x228)](_0x9a6b23(0x179),_0x2e385e),common_1[_0x9a6b23(0x295)][_0x9a6b23(0x15e)](_0x9a6b23(0x1a1),'MidjourneyService');throw new common_1['HttpException'](_0x9a6b23(0x24f),common_1[_0x9a6b23(0x213)][_0x9a6b23(0x160)]);}}async[_0x50821a(0x2b2)](_0x448c8f,_0x1fbcb6){const _0x58528d=_0x50821a,{message_id:_0x1c4ec6,custom_id:_0x3d186a}=_0x448c8f,{application_id:_0x54d309,guild_id:_0x17dfa8,channel_id:_0x5e44fb,session_id:_0x99ff2b,version:_0x5e5b8c,id:_0x1c51be,authorization:_0x1a72f5,mjProxy:_0x246791}=await this[_0x58528d(0x23d)](),_0x23d8ca=await this['globalConfigService'][_0x58528d(0x254)](['mjProxyUrl'])||_0x58528d(0x192),_0x2b01ea=_0x246791==0x1?_0x23d8ca+_0x58528d(0x18e):'https://discord.com/api/v9/interactions',_0x4eaabd={'authorization':_0x1a72f5},_0x4a57f5={'type':0x3,'guild_id':_0x17dfa8,'channel_id':_0x5e44fb,'message_id':_0x1c4ec6,'application_id':_0x54d309,'session_id':_0x99ff2b,'data':{'component_type':0x2,'custom_id':_0x3d186a}};try{await axios_1[_0x58528d(0x264)][_0x58528d(0x255)](_0x2b01ea,_0x4a57f5,{'headers':_0x4eaabd});}catch(_0xecfb1f){console[_0x58528d(0x228)](_0x58528d(0x179),_0xecfb1f),common_1[_0x58528d(0x295)]['error'](_0x58528d(0x1a1),_0x58528d(0x1d8));throw new common_1[(_0x58528d(0x1fc))](_0x58528d(0x24f),common_1[_0x58528d(0x213)]['BAD_REQUEST']);}}async['pollComparisonResultDraw'](_0x311554){const _0x48763a=_0x50821a;common_1[_0x48763a(0x295)][_0x48763a(0x207)](_0x48763a(0x220),_0x48763a(0x1d8));const _0x19842e=Date[_0x48763a(0x1ac)](),_0x33c0da=0x2710,_0x2033e0=0x4e20,_0x4c7331=await this['globalConfigService']['getConfigs']([_0x48763a(0x1b3)])||0x249f0,_0x3de72e=_0x4c7331;let _0x38c989=0x0,_0x536e27=null,_0x32c22c=![];const {id:_0x2322a4,mjProxy:_0x3d4061}=await this[_0x48763a(0x23d)]();try{while(!_0x32c22c&&Date[_0x48763a(0x1ac)]()-_0x19842e<_0x3de72e){let _0xd34c8f;Date[_0x48763a(0x1ac)]()-_0x19842e<0x15f90?_0xd34c8f=_0x33c0da:_0xd34c8f=_0x2033e0;await this[_0x48763a(0x26b)](_0xd34c8f),common_1[_0x48763a(0x295)]['debug'](_0x48763a(0x1a5)+(_0x38c989+0x1)+_0x48763a(0x1e3),_0x48763a(0x1d8)),console[_0x48763a(0x228)](_0x48763a(0x2b6),_0x311554),_0x536e27=await this[_0x48763a(0x1b7)](_0x311554[_0x48763a(0x2ab)]);if(_0x536e27){const {content:_0x1f15f4}=_0x536e27,_0x107a59=await this[_0x48763a(0x2ac)](_0x1f15f4);common_1[_0x48763a(0x295)][_0x48763a(0x207)]('【绘制图片】第\x20'+(_0x38c989+0x1)+_0x48763a(0x210)+_0x107a59+'%',_0x48763a(0x1d8)),await this['midjourneyEntity'][_0x48763a(0x19a)]({'id':_0x311554['id']},{'progress':_0x107a59!==null&&_0x107a59!==void 0x0?_0x107a59:0x64});}_0x32c22c=_0x536e27&&!_0x536e27[_0x48763a(0x287)],_0x38c989++;}if(!_0x536e27){await this[_0x48763a(0x1b8)](_0x311554['id'],midjourney_constant_1[_0x48763a(0x164)]['DRAWTIMEOUT']);throw new common_1[(_0x48763a(0x1fc))]('绘画超时，请稍后再试！',common_1[_0x48763a(0x213)][_0x48763a(0x160)]);}const _0x13c85=Date[_0x48763a(0x1ac)]();return Object[_0x48763a(0x205)](Object[_0x48763a(0x205)]({},_0x536e27),{'durationSpent':Math[_0x48763a(0x185)]((_0x13c85-_0x19842e)/0x3e8)});}catch(_0x5b3933){console[_0x48763a(0x228)](_0x48763a(0x1ea),_0x5b3933);throw new common_1['HttpException']('获取图片列表结果失败',common_1[_0x48763a(0x213)]['BAD_REQUEST']);}}async['pollComparisonResultDraw2'](_0x497351,_0x5c71d8){const _0x4c4f55=_0x50821a;var _0x4e76ec,_0x238b88;common_1[_0x4c4f55(0x295)]['debug'](_0x4c4f55(0x220),_0x4c4f55(0x1d8));const _0x18397e=Date[_0x4c4f55(0x1ac)](),_0x5b97b5=0x2710,_0x404b45=0x4e20,_0x2bf28f=await this[_0x4c4f55(0x23a)]['getConfigs'](['mjTimeoutMs'])||0x249f0,_0x3692d0=_0x2bf28f;let _0x54b100=0x0,_0x395b21=null,_0x431e97=![];try{while(!_0x431e97&&Date[_0x4c4f55(0x1ac)]()-_0x18397e<_0x3692d0){let _0x4fef4c;Date[_0x4c4f55(0x1ac)]()-_0x18397e<0x15f90?_0x4fef4c=_0x5b97b5:_0x4fef4c=_0x404b45;await this['sleep'](_0x4fef4c),common_1[_0x4c4f55(0x295)]['debug'](_0x4c4f55(0x1a5)+(_0x54b100+0x1)+'\x20次开始查询','MidjourneyService'),console[_0x4c4f55(0x228)](_0x4c4f55(0x1ed),_0x5c71d8);if(_0x5c71d8[_0x4c4f55(0x177)]===null)throw new common_1[(_0x4c4f55(0x1fc))](_0x4c4f55(0x229),common_1[_0x4c4f55(0x213)][_0x4c4f55(0x160)]);;_0x395b21=await this[_0x4c4f55(0x279)](_0x5c71d8[_0x4c4f55(0x177)]),console[_0x4c4f55(0x228)](_0x4c4f55(0x16f),_0x395b21[_0x4c4f55(0x20e)]);const _0x573585=_0x395b21['data']['progress'],_0x2a2d1f=(_0x238b88=(_0x4e76ec=_0x395b21[_0x4c4f55(0x20e)])===null||_0x4e76ec===void 0x0?void 0x0:_0x4e76ec[_0x4c4f55(0x17a)])!==null&&_0x238b88!==void 0x0?_0x238b88:'默认消息';if(_0x395b21){common_1['Logger']['debug'](_0x4c4f55(0x1a5)+(_0x54b100+0x1)+'\x20次、\x20当前绘画进度为'+_0x573585,_0x4c4f55(0x1d8));if(_0x573585&&_0x573585[_0x4c4f55(0x20a)]<0x7){const _0x1bffaf=parseInt(_0x573585[_0x4c4f55(0x1ee)]('%',''),0xa);await this[_0x4c4f55(0x209)]['update']({'id':_0x497351['id']},{'progress':_0x1bffaf});}};if(_0x2a2d1f==='没有相关任务')throw new common_1[(_0x4c4f55(0x1fc))](_0x4c4f55(0x16a),common_1['HttpStatus'][_0x4c4f55(0x160)]);;if(_0x5c71d8[_0x4c4f55(0x15e)])throw new common_1[(_0x4c4f55(0x1fc))]('未知错误0990！',common_1[_0x4c4f55(0x213)][_0x4c4f55(0x160)]);;if(_0x573585!=='100%')_0x431e97=![],_0x54b100++;else return _0x395b21;;}if(Date[_0x4c4f55(0x1ac)]()-_0x18397e>_0x3692d0){await this[_0x4c4f55(0x1b8)](_0x497351['id'],midjourney_constant_1[_0x4c4f55(0x164)][_0x4c4f55(0x1bb)]);throw new common_1[(_0x4c4f55(0x1fc))](_0x4c4f55(0x272),common_1[_0x4c4f55(0x213)][_0x4c4f55(0x160)]);}const _0x4f7b99=Date['now']();return Object['assign'](Object[_0x4c4f55(0x205)]({},_0x395b21),{'durationSpent':Math[_0x4c4f55(0x185)]((_0x4f7b99-_0x18397e)/0x3e8)});}catch(_0x425974){console[_0x4c4f55(0x228)]('获取图片列表结果失败:\x20',_0x425974);throw new common_1['HttpException'](_0x4c4f55(0x2b4),common_1[_0x4c4f55(0x213)][_0x4c4f55(0x160)]);}}async[_0x50821a(0x17e)](_0x4f5655){const _0x494f3d=_0x50821a;common_1[_0x494f3d(0x295)]['debug'](_0x494f3d(0x1c1),_0x494f3d(0x1d8));const _0x172aaa=Date['now'](),{message_id:_0x26dfbe,custom_id:_0xeb056c,randomDrawId:_0x74f841,orderId:_0x18aae5}=_0x4f5655;let _0x55c728=null,_0x4ec762=0x0;while(!_0x55c728&&_0x4ec762<0xa){common_1['Logger'][_0x494f3d(0x207)]('开始比对放大图片第'+(_0x4ec762+0x1)+'次','MidjourneyService'),_0x55c728=await this['findCurrentEnlargeImgResult'](_0x74f841,_0x18aae5),await new Promise(_0x88dfcb=>setTimeout(_0x88dfcb,Math['floor'](Math['random']()*(0x1388-0xbb8+0x1))+0xbb8)),_0x4ec762++;}if(!_0x55c728){await this[_0x494f3d(0x1b8)](_0x4f5655['id'],midjourney_constant_1[_0x494f3d(0x164)]['DRAWTIMEOUT']);throw new common_1[(_0x494f3d(0x1fc))](_0x494f3d(0x2ad),common_1[_0x494f3d(0x213)][_0x494f3d(0x160)]);}const _0x34512f=Date['now']();return Object[_0x494f3d(0x205)](Object['assign']({},_0x55c728),{'durationSpent':Math[_0x494f3d(0x185)]((_0x34512f-_0x172aaa)/0x3e8)});}async[_0x50821a(0x204)](_0x5153e1){const _0x1944dd=_0x50821a;common_1['Logger'][_0x1944dd(0x207)](_0x1944dd(0x299),_0x1944dd(0x1d8));const _0x2f2a20=await this[_0x1944dd(0x23a)][_0x1944dd(0x254)]([_0x1944dd(0x1b3)])||0x249f0,_0x3c39a2=Date[_0x1944dd(0x1ac)](),{message_id:_0x4bb857,custom_id:_0x4bbaa6,randomDrawId:_0x3aa570,orderId:_0x2a2543}=_0x5153e1;let _0x5d133b=null,_0x24179a=0x0,_0x32f745=0x0;while(!_0x5d133b&&_0x24179a<_0x2f2a20){common_1[_0x1944dd(0x295)][_0x1944dd(0x207)](_0x1944dd(0x289)+(_0x32f745+0x1)+'次',_0x1944dd(0x1d8)),_0x5d133b=await this[_0x1944dd(0x291)](_0x3aa570,_0x4bb857);const _0x49447e=Math[_0x1944dd(0x185)](Math[_0x1944dd(0x2a4)]()*(0x1388-0xbb8+0x1))+0x1f40;await new Promise(_0x104a22=>setTimeout(_0x104a22,_0x49447e)),_0x24179a+=_0x49447e,_0x32f745++;}if(!_0x5d133b){await this[_0x1944dd(0x1b8)](_0x5153e1['id'],midjourney_constant_1[_0x1944dd(0x164)][_0x1944dd(0x1bb)]);throw new common_1[(_0x1944dd(0x1fc))](_0x1944dd(0x248),common_1[_0x1944dd(0x213)][_0x1944dd(0x160)]);}const _0xe451c8=Date['now']();return Object[_0x1944dd(0x205)](Object[_0x1944dd(0x205)]({},_0x5d133b),{'durationSpent':Math[_0x1944dd(0x185)]((_0xe451c8-_0x3c39a2)/0x3e8)});}async[_0x50821a(0x1d9)](_0x3e399d){const _0x2b07aa=_0x50821a;common_1[_0x2b07aa(0x295)][_0x2b07aa(0x207)](_0x2b07aa(0x1b9),_0x2b07aa(0x1d8));const _0x5c8f9c=await this[_0x2b07aa(0x23a)][_0x2b07aa(0x254)]([_0x2b07aa(0x1b3)])||0x249f0,_0x5f39eb=Date[_0x2b07aa(0x1ac)](),{message_id:_0xdf571d,custom_id:_0x4d66d3,randomDrawId:_0x232a3c,orderId:_0x2af6db}=_0x3e399d;let _0x2ef1f8=null,_0x4d6dba=0x0,_0x26c244=0x0;while(!_0x2ef1f8&&_0x4d6dba<_0x5c8f9c){common_1['Logger'][_0x2b07aa(0x207)](_0x2b07aa(0x25e)+(_0x26c244+0x1)+'次',_0x2b07aa(0x1d8)),_0x2ef1f8=await this[_0x2b07aa(0x1e4)](_0x232a3c,_0xdf571d);const _0x2f8299=Math[_0x2b07aa(0x185)](Math[_0x2b07aa(0x2a4)]()*(0x1388-0xbb8+0x1))+0x1f40;await new Promise(_0xc13c3f=>setTimeout(_0xc13c3f,_0x2f8299)),_0x4d6dba+=_0x2f8299,_0x26c244++;}if(!_0x2ef1f8){await this[_0x2b07aa(0x1b8)](_0x3e399d['id'],midjourney_constant_1[_0x2b07aa(0x164)][_0x2b07aa(0x1bb)]);throw new common_1[(_0x2b07aa(0x1fc))](_0x2b07aa(0x1a8),common_1[_0x2b07aa(0x213)][_0x2b07aa(0x160)]);}const _0x29816f=Date['now']();return Object[_0x2b07aa(0x205)](Object['assign']({},_0x2ef1f8),{'durationSpent':Math[_0x2b07aa(0x185)]((_0x29816f-_0x5f39eb)/0x3e8)});}async[_0x50821a(0x218)](_0x1188c0){const _0x2bc786=_0x50821a;common_1[_0x2bc786(0x295)]['debug'](_0x2bc786(0x26c),_0x2bc786(0x1d8));const _0x43f02d=await this[_0x2bc786(0x23a)]['getConfigs']([_0x2bc786(0x1b3)])||0x249f0,_0x5b4d7d=Date['now'](),{message_id:_0x1fc73a,custom_id:_0x48fa8c,randomDrawId:_0x2b2017,orderId:_0x538ef2}=_0x1188c0;let _0x16fe91=null,_0x36d010=0x0,_0x1f4e7d=0x0;while(!_0x16fe91&&_0x36d010<_0x43f02d){common_1[_0x2bc786(0x295)][_0x2bc786(0x207)](_0x2bc786(0x182)+(_0x1f4e7d+0x1)+'次','MidjourneyService'),_0x16fe91=await this['findCurrentZoomImgResult'](_0x2b2017,_0x1fc73a);const _0x27f465=Math[_0x2bc786(0x185)](Math[_0x2bc786(0x2a4)]()*(0x1388-0xbb8+0x1))+0x1f40;await new Promise(_0x52e603=>setTimeout(_0x52e603,_0x27f465)),_0x36d010+=_0x27f465,_0x1f4e7d++;}if(!_0x16fe91){await this[_0x2bc786(0x1b8)](_0x1188c0['id'],midjourney_constant_1['MidjourneyStatusEnum']['DRAWTIMEOUT']);throw new common_1[(_0x2bc786(0x1fc))]('单张图片缩放超时，请稍后再试！',common_1['HttpStatus'][_0x2bc786(0x160)]);}const _0x1ff2f7=Date['now']();return Object[_0x2bc786(0x205)](Object[_0x2bc786(0x205)]({},_0x16fe91),{'durationSpent':Math[_0x2bc786(0x185)]((_0x1ff2f7-_0x5b4d7d)/0x3e8)});}async[_0x50821a(0x298)](_0x17d9c4){const _0x160f97=_0x50821a;common_1[_0x160f97(0x295)][_0x160f97(0x207)](_0x160f97(0x1b6),_0x160f97(0x1d8));let _0x46714b=null;const _0x4f6744=Date[_0x160f97(0x1ac)]();while(!_0x46714b){common_1[_0x160f97(0x295)][_0x160f97(0x207)](_0x160f97(0x22c),_0x160f97(0x1d8)),_0x46714b=await this[_0x160f97(0x2a2)](_0x17d9c4[_0x160f97(0x2ab)]);const _0x1f00ca=0x2710;await this[_0x160f97(0x26b)](_0x1f00ca);const _0x3d9751=Date[_0x160f97(0x1ac)](),_0x15563a=Math[_0x160f97(0x185)](_0x3d9751-_0x4f6744),_0x2a3ccf=await this[_0x160f97(0x23a)]['getConfigs']([_0x160f97(0x1b3)])||0x249f0,_0x209387=_0x2a3ccf;if(_0x15563a>=_0x209387){await this[_0x160f97(0x1b8)](_0x17d9c4['id'],midjourney_constant_1[_0x160f97(0x164)][_0x160f97(0x1bb)]);throw new common_1[(_0x160f97(0x1fc))](_0x160f97(0x187),common_1[_0x160f97(0x213)][_0x160f97(0x160)]);}}return Object[_0x160f97(0x205)](Object[_0x160f97(0x205)]({},_0x46714b),{'durationSpent':Math[_0x160f97(0x185)](Date[_0x160f97(0x1ac)]()-_0x4f6744)});}async[_0x50821a(0x1da)](_0x13b69a,_0x390f89){const _0x3e721b=_0x50821a,_0x5950c4=await this[_0x3e721b(0x1eb)](),_0x3e8469=await this[_0x3e721b(0x29e)](_0x13b69a),_0x259131=_0x5950c4[_0x3e721b(0x27b)](_0x108816=>{const _0x2d9d04=_0x3e721b,{content:_0x5c6f7a}=_0x108816;if(!this[_0x2d9d04(0x1e9)](_0x5c6f7a))return![];const {prompt:_0x4092ea,order:_0x1ffed6}=this[_0x2d9d04(0x1e9)](_0x5c6f7a);return _0x5c6f7a[_0x2d9d04(0x2a0)](_0x13b69a)&&_0x390f89===_0x1ffed6&&!_0x3e8469[_0x2d9d04(0x2a0)](_0x108816['id']);});return _0x259131;}async['findCurrentVariationImgResult'](_0x53eb61){const _0x53af7d=_0x50821a,_0x4506aa=await this['getMessageList'](),_0x1d7e71=await this[_0x53af7d(0x29e)](_0x53eb61),_0x397d30=_0x4506aa[_0x53af7d(0x27b)](_0x1b509a=>{const _0x1c109c=_0x53af7d,{content:_0x2df5c6}=_0x1b509a;return _0x2df5c6[_0x1c109c(0x2a0)](_0x53eb61)&&!_0x1d7e71[_0x1c109c(0x2a0)](_0x1b509a['id'])&&this[_0x1c109c(0x245)](_0x2df5c6);});if(_0x397d30){if(this[_0x53af7d(0x222)][_0x53af7d(0x2a0)](_0x53eb61))return common_1['Logger']['debug'](_0x53af7d(0x1a3),_0x53af7d(0x1d8)),null;else this[_0x53af7d(0x222)]['push'](_0x53eb61);}return _0x397d30;}async[_0x50821a(0x291)](_0x1431ca,_0x4521d2){const _0x35da3e=_0x50821a,_0x19c8f5=await this[_0x35da3e(0x1eb)](),_0xf2964f=await this[_0x35da3e(0x29e)](_0x1431ca),_0x534ed7=_0x19c8f5[_0x35da3e(0x27b)](_0x20ef27=>{const _0x436238=_0x35da3e,{content:_0x3a9074}=_0x20ef27;return _0x3a9074[_0x436238(0x2a0)](_0x1431ca)&&!_0xf2964f[_0x436238(0x2a0)](_0x20ef27['id'])&&_0x20ef27['id']!==_0x4521d2&&this[_0x436238(0x266)](_0x3a9074);});if(_0x534ed7){if(this[_0x35da3e(0x222)][_0x35da3e(0x2a0)](_0x1431ca))return common_1[_0x35da3e(0x295)]['debug']('【重新生成图片】当前图片已经被锁定，等待同任务完成',_0x35da3e(0x1d8)),null;else this['lockPrompt'][_0x35da3e(0x15f)](_0x1431ca);}return _0x534ed7;}async[_0x50821a(0x247)](_0xf5d77d,_0x3f45f2){const _0x1411c4=_0x50821a,_0xc90d56=await this['getMessageList'](),_0x4d5cbd=await this[_0x1411c4(0x29e)](_0xf5d77d),_0x32f647=_0xc90d56[_0x1411c4(0x27b)](_0x13073b=>{const _0x2e41ef=_0x1411c4,{content:_0x583d82}=_0x13073b;return _0x583d82[_0x2e41ef(0x2a0)](_0xf5d77d)&&!_0x4d5cbd[_0x2e41ef(0x2a0)](_0x13073b['id'])&&_0x13073b['id']!==_0x3f45f2&&this[_0x2e41ef(0x19e)](_0x583d82);});if(_0x32f647){if(this[_0x1411c4(0x222)][_0x1411c4(0x2a0)](_0xf5d77d))return common_1[_0x1411c4(0x295)]['debug'](_0x1411c4(0x269),_0x1411c4(0x1d8)),null;else this[_0x1411c4(0x222)][_0x1411c4(0x15f)](_0xf5d77d);}return _0x32f647;}async[_0x50821a(0x1e4)](_0x19f264,_0x10b89f){const _0x421f25=_0x50821a,_0x415c12=await this[_0x421f25(0x1eb)](),_0x1886ac=await this[_0x421f25(0x29e)](_0x19f264),_0x59ba2e=_0x415c12[_0x421f25(0x27b)](_0x158ad4=>{const _0x3fc5b9=_0x421f25,{content:_0x53c351}=_0x158ad4;return _0x53c351[_0x3fc5b9(0x2a0)](_0x19f264)&&!_0x1886ac[_0x3fc5b9(0x2a0)](_0x158ad4['id'])&&_0x158ad4['id']!==_0x10b89f&&this[_0x3fc5b9(0x189)](_0x53c351);});if(_0x59ba2e){if(this[_0x421f25(0x222)][_0x421f25(0x2a0)](_0x19f264))return common_1[_0x421f25(0x295)][_0x421f25(0x207)]('【单张图片增强】当前图片已经被锁定，等待同任务完成','MidjourneyService'),null;else this['lockPrompt'][_0x421f25(0x15f)](_0x19f264);}return _0x59ba2e;}[_0x50821a(0x1e9)](_0x2c7249){const _0x222e1d=_0x50821a,_0x4f186c=_0x2c7249[_0x222e1d(0x2a8)](/\*\*(.+?)\*\*/),_0x421abf=_0x2c7249[_0x222e1d(0x2a8)](/- Image #(\d+)/);if(!_0x4f186c||!_0x421abf)return null;const _0x4174b3=_0x4f186c[0x1],_0x44503f=parseInt(_0x421abf[0x1]);return{'prompt':_0x4174b3,'order':_0x44503f};}async['findCurrentPromptResult'](_0xd2c902){const _0x1906c8=_0x50821a,_0x1490df=await this[_0x1906c8(0x29e)](_0xd2c902),_0x157c59=await this[_0x1906c8(0x1eb)]();console[_0x1906c8(0x228)](_0x1906c8(0x1fe),_0x157c59);if(!_0x157c59||!_0x157c59[_0x1906c8(0x20a)])return;const _0x64e6ce=_0x157c59['find'](_0x3e73f1=>{const _0x313b8f=_0x1906c8,{attachments:attachments=[],content:_0x47b2e6,edited_timestamp:_0x99e75f}=_0x3e73f1;return _0x47b2e6[_0x313b8f(0x2a0)](_0xd2c902)&&attachments['length']>0x0&&!_0x1490df[_0x313b8f(0x2a0)](_0x3e73f1===null||_0x3e73f1===void 0x0?void 0x0:_0x3e73f1['id']);});return _0x64e6ce||null;}async['findCurrentPromptResult2'](_0x43e971){const _0x391d06=_0x50821a,{authorization:_0x11ec4b}=await this[_0x391d06(0x23d)](),_0x212c08=_0x43e971,_0x8d24ff=await this[_0x391d06(0x23a)][_0x391d06(0x254)]([_0x391d06(0x29c)])||_0x391d06(0x192),_0x24d5db=_0x8d24ff+_0x391d06(0x28f)+_0x212c08+_0x391d06(0x27f),_0x2b649d={'mj-api-secret':_0x11ec4b,'Authorization':_0x11ec4b};console[_0x391d06(0x228)]('fullurl2423412',_0x24d5db),console[_0x391d06(0x228)]('headers324234',_0x2b649d);try{const _0x595c76=await axios_1[_0x391d06(0x264)][_0x391d06(0x1cf)](_0x24d5db,{'headers':_0x2b649d});return console[_0x391d06(0x228)](_0x391d06(0x1b2)),_0x595c76;}catch(_0x3b4bcc){console[_0x391d06(0x228)](_0x391d06(0x29b),_0x3b4bcc);}}[_0x50821a(0x245)](_0x26c8a3){const _0x1d22dd=/- Variations/;return _0x1d22dd['test'](_0x26c8a3);}[_0x50821a(0x25d)](_0x405399){const _0x47ba04=_0x50821a,_0xdf4c63=/Image #\d+/;return _0xdf4c63[_0x47ba04(0x241)](_0x405399);}[_0x50821a(0x266)](_0x4ea0b5){const _0x126577=_0x50821a;return!this['isVariationsImage'](_0x4ea0b5)&&!this[_0x126577(0x25d)](_0x4ea0b5);}[_0x50821a(0x189)](_0x24e9d2){const _0x369bcf=/- Variations \(.*?\)/;return _0x369bcf['test'](_0x24e9d2);}[_0x50821a(0x19e)](_0x35298f){const _0x4d167a=/- Zoom Out/;return _0x4d167a['test'](_0x35298f);}async[_0x50821a(0x23d)](){const _0x4f690b=_0x50821a,_0x53bbe6=await this[_0x4f690b(0x23a)][_0x4f690b(0x254)](['mjId',_0x4f690b(0x268),_0x4f690b(0x1db),'mjChannelId','mjSessionId',_0x4f690b(0x286),_0x4f690b(0x2b1),_0x4f690b(0x23f),_0x4f690b(0x1f4)]),_0x19fb36={'application_id':_0x53bbe6[_0x4f690b(0x268)],'guild_id':_0x53bbe6['mjGuildId'],'channel_id':_0x53bbe6[_0x4f690b(0x276)],'session_id':_0x53bbe6[_0x4f690b(0x249)],'version':_0x53bbe6['mjVersion'],'id':_0x53bbe6[_0x4f690b(0x1e0)],'authorization':_0x53bbe6[_0x4f690b(0x2b1)],'mjRateLimit':_0x53bbe6[_0x4f690b(0x23f)],'mjProxy':_0x53bbe6[_0x4f690b(0x1f4)]||0x0};return _0x19fb36;}async['getMessageList'](){const _0x1e80ee=_0x50821a;try{const {application_id:_0xaf86be,guild_id:_0x402401,channel_id:_0x44d97e,session_id:_0x4c7766,version:_0x3549c2,id:_0x16a0ed,authorization:_0x5b71da,mjProxy:_0x118cce}=await this['getMjDefaultParams'](),_0x183663=await this['globalConfigService']['getConfigs']([_0x1e80ee(0x29c)])||_0x1e80ee(0x192),_0x1695af=_0x118cce==0x1?_0x183663+_0x1e80ee(0x17f)+_0x44d97e:_0x1e80ee(0x225)+_0x44d97e+_0x1e80ee(0x271),_0x31847f={'authorization':_0x5b71da},_0x1296a9=await axios_1[_0x1e80ee(0x264)][_0x1e80ee(0x1cf)](_0x1695af,{'headers':_0x31847f});return _0x1296a9[_0x1e80ee(0x20e)];}catch(_0x5434ff){return common_1[_0x1e80ee(0x295)]['error'](_0x1e80ee(0x190),_0x5434ff,_0x1e80ee(0x1d8)),[];}}[_0x50821a(0x2ac)](_0x4534cb){const _0x5870f1=_0x50821a,_0x1cbe60=/\((\d+)%\)/,_0x4c360d=_0x4534cb[_0x5870f1(0x2a8)](_0x1cbe60);return _0x4c360d?parseInt(_0x4c360d[0x1],0xa):null;}[_0x50821a(0x221)](_0x138556){const _0x1af989=_0x50821a,_0x15acc8=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;return _0x138556[_0x1af989(0x1ee)](_0x15acc8,'');}async['bindJobId'](_0x48c3e4,_0x37796f){const _0x54fa82=_0x50821a;await this[_0x54fa82(0x209)][_0x54fa82(0x19a)]({'id':_0x48c3e4},{'jobId':_0x37796f});}async[_0x50821a(0x162)](_0x5b2ae4,_0x4c8fb0){const _0x50593d=_0x50821a;try{const {page:page=0x1,size:size=0x1e}=_0x4c8fb0,[_0x364272,_0x3c18ff]=await this[_0x50593d(0x209)][_0x50593d(0x2a7)]({'where':{'userId':_0x5b2ae4['user']['id'],'isDelete':0x0},'order':{'id':'DESC'},'take':size,'skip':(page-0x1)*size}),_0x5d0e74=await this['globalConfigService']['getConfigs']([_0x50593d(0x2a1)]);_0x364272['forEach'](_0x432bdb=>{const _0x22ac61=_0x50593d;var _0x24447c,_0x5b007a,_0x188fc9,_0x2127b5,_0x27f452,_0x73a08,_0x5b78dc;try{const {extend:_0x5e7d45,isSaveImg:_0x15cd58,fileInfo:_0x31877d}=_0x432bdb,_0x5d77f1=JSON[_0x22ac61(0x18a)](_0x5e7d45),_0x39dbd8=_0x5d77f1===null||_0x5d77f1===void 0x0?void 0x0:_0x5d77f1[_0x22ac61(0x1fd)],_0x294cb0=_0x5d77f1===null||_0x5d77f1===void 0x0?void 0x0:_0x5d77f1[_0x22ac61(0x242)],_0x3e7d6c=(_0x2127b5=(_0x188fc9=(_0x5b007a=(_0x24447c=_0x5d77f1===null||_0x5d77f1===void 0x0?void 0x0:_0x5d77f1[_0x22ac61(0x20e)])===null||_0x24447c===void 0x0?void 0x0:_0x24447c[_0x22ac61(0x267)])===null||_0x5b007a===void 0x0?void 0x0:_0x5b007a[0x0])===null||_0x188fc9===void 0x0?void 0x0:_0x188fc9['label'])!==null&&_0x2127b5!==void 0x0?_0x2127b5:null,_0x2963e6=(_0x5b78dc=(_0x73a08=(_0x27f452=_0x5d77f1===null||_0x5d77f1===void 0x0?void 0x0:_0x5d77f1['buttons'])===null||_0x27f452===void 0x0?void 0x0:_0x27f452[0x0])===null||_0x73a08===void 0x0?void 0x0:_0x73a08['label'])!==null&&_0x5b78dc!==void 0x0?_0x5b78dc:null,_0x3973af=Array[_0x22ac61(0x1a6)](_0x39dbd8)&&_0x39dbd8[_0x22ac61(0x20a)]>0x0?_0x39dbd8[0x0][_0x22ac61(0x21c)]:null;_0x432bdb[_0x22ac61(0x2ae)]=this[_0x22ac61(0x275)](_0x31877d,_0x15cd58,_0x5d0e74,_0x3973af);const _0x569247=Array[_0x22ac61(0x1a6)](_0x294cb0)&&_0x294cb0[_0x22ac61(0x20a)]>0x0&&Array['isArray'](_0x294cb0[0x0][_0x22ac61(0x242)])&&_0x294cb0[0x0][_0x22ac61(0x242)][_0x22ac61(0x20a)]>0x0&&_0x294cb0[0x0][_0x22ac61(0x242)][0x0][_0x22ac61(0x234)]==='U1';_0x432bdb[_0x22ac61(0x1aa)]=_0x569247;_0x3e7d6c==='U1'&&(_0x432bdb[_0x22ac61(0x1aa)]=!![]);;_0x2963e6==='U1'&&(_0x432bdb[_0x22ac61(0x1aa)]=!![]);;_0x432bdb['originUrl']=_0x3973af;}catch(_0x223cf7){console[_0x22ac61(0x228)]('error646',_0x223cf7);}});const _0x57a052=await this[_0x50593d(0x209)][_0x50593d(0x1b0)]({'where':{'isDelete':0x0,'status':(0x0,typeorm_2['In'])([0x1,0x2])}}),_0x8e258={'rows':(0x0,utils_1[_0x50593d(0x22b)])(_0x364272),'count':_0x3c18ff,'countQueue':_0x57a052};return _0x8e258;}catch(_0x20d7c9){throw new common_1[(_0x50593d(0x1fc))](_0x50593d(0x186),common_1[_0x50593d(0x213)]['BAD_REQUEST']);};}[_0x50821a(0x275)](_0x52a110,_0x1f06c9,_0x5c5401,_0x33bb81){const _0xfbb58d=_0x50821a;if(!_0x52a110)return{};let _0x4555e8=null;try{_0x4555e8=JSON[_0xfbb58d(0x18a)](_0x52a110);}catch(_0x195df5){_0x4555e8=null;}if(!_0x4555e8)return;const {url:_0x20eae4,filename:_0x532751,size:_0x4d6fd3,cosUrl:_0x2078b9,width:_0x4221c8,height:_0x3a8df6}=_0x4555e8,_0x441718=0x136,_0x4b7e9f=_0x2078b9[_0xfbb58d(0x2a0)]('cos')?_0xfbb58d(0x20d):_0x2078b9[_0xfbb58d(0x2a0)](_0xfbb58d(0x243))?_0xfbb58d(0x1f9):'chevereto';let _0x435bea,_0x40b7ef;if(_0x4b7e9f==='tencent'){const _0x3c4f60=_0x4221c8/_0x3a8df6,_0x5c78d0=Math[_0xfbb58d(0x25b)](_0x441718/_0x3c4f60);_0x40b7ef=_0x2078b9+(_0xfbb58d(0x217)+_0x441718+_0xfbb58d(0x1c8)+_0x5c78d0+_0xfbb58d(0x270));}if(_0x4b7e9f===_0xfbb58d(0x1f9)){const _0x1ea447=_0x3a8df6/_0x4221c8,_0x5c7fb0=Math[_0xfbb58d(0x25b)](_0x441718/_0x1ea447);_0x40b7ef=_0x2078b9+(_0xfbb58d(0x26e)+_0x5c7fb0);}return _0x4b7e9f===_0xfbb58d(0x256)&&(_0x40b7ef=_0x2078b9[_0xfbb58d(0x1ee)](/\.png$/,_0xfbb58d(0x1fb))),_0x4555e8[_0xfbb58d(0x278)]=_0x40b7ef,_0x4555e8;}async[_0x50821a(0x292)](_0x34f6e9){const _0x5d70c5=_0x50821a,_0x30a951=await this[_0x5d70c5(0x209)][_0x5d70c5(0x29d)]({'where':{'id':_0x34f6e9}});if(!_0x30a951)throw new common_1['HttpException'](_0x5d70c5(0x274),common_1['HttpStatus']['BAD_REQUEST']);const {custom_id:_0x3f69d2,message_id:_0x5ddfb8,prompt:_0x514f05,imgUrl:_0x2df9e8,extraParam:_0x440126,randomDrawId:_0xaa892a,extend:_0x5936f6}=_0x30a951;return{'custom_id':_0x3f69d2,'message_id':_0x5ddfb8,'prompt':_0x514f05,'imgUrl':_0x2df9e8,'extraParam':_0x440126,'randomDrawId':_0xaa892a,'extend':_0x5936f6};}async[_0x50821a(0x1ca)](_0x2b98e0){const _0x2bf622=_0x50821a,_0x2f7b9d=await this[_0x2bf622(0x209)][_0x2bf622(0x29d)]({'where':{'id':_0x2b98e0}});if(!_0x2f7b9d)throw new common_1['HttpException']('当前绘画信息不存在！',common_1['HttpStatus'][_0x2bf622(0x160)]);const {custom_id:_0xd25ed7,message_id:_0x6ffa0e,imgUrl:_0x5b5dff,extraParam:_0x125eab,randomDrawId:_0x138ad2,extend:_0x5d7e46}=_0x2f7b9d;return{'custom_id':_0xd25ed7,'message_id':_0x6ffa0e,'imgUrl':_0x5b5dff,'extraParam':_0x125eab,'randomDrawId':_0x138ad2,'extend':_0x5d7e46};}async[_0x50821a(0x246)](_0x6234d2,_0x5d014c,_0x561c9f){const _0x22ae7e=_0x50821a,_0xb9bbbe=await this[_0x22ae7e(0x209)][_0x22ae7e(0x29d)]({'where':{'id':_0x5d014c}});if(!_0xb9bbbe)throw new common_1[(_0x22ae7e(0x1fc))](_0x22ae7e(0x274),common_1[_0x22ae7e(0x213)][_0x22ae7e(0x160)]);const {extend:_0x11d4c0,message_id:_0x5bdb9e,prompt:_0x60261e,imgUrl:_0x2d8284,extraParam:_0x92bf4c,randomDrawId:_0x51e05e}=_0xb9bbbe,_0x42d761=JSON[_0x22ae7e(0x18a)](_0x11d4c0),{components:components=[]}=_0x42d761;if(!components[_0x22ae7e(0x20a)])throw new common_1[(_0x22ae7e(0x1fc))]('当前图片没有绘画信息、无法放大!',common_1['HttpStatus'][_0x22ae7e(0x160)]);let _0x3185b4={};_0x6234d2===midjourney_constant_1[_0x22ae7e(0x19f)][_0x22ae7e(0x288)]&&(_0x3185b4=components[0x0][_0x22ae7e(0x242)][_0x561c9f-0x1]);_0x6234d2===midjourney_constant_1[_0x22ae7e(0x19f)][_0x22ae7e(0x216)]&&(_0x3185b4=components[0x1][_0x22ae7e(0x242)][_0x561c9f-0x1]);_0x6234d2===midjourney_constant_1['MidjourneyActionEnum'][_0x22ae7e(0x16d)]&&(_0x3185b4=components[0x0][_0x22ae7e(0x242)][_0x561c9f-0x1]);(_0x6234d2===0x7||_0x6234d2===0x8)&&(_0x3185b4=components[0x0][_0x22ae7e(0x242)][_0x561c9f-0x1]);(_0x6234d2===0x6||_0x6234d2===0x9)&&(_0x3185b4=components[0x1][_0x22ae7e(0x242)][_0x561c9f-0x1]);const {custom_id:_0x14cad2}=_0x3185b4;return{'custom_id':_0x14cad2,'message_id':_0x5bdb9e,'prompt':_0x60261e,'imgUrl':_0x2d8284,'extraParam':_0x92bf4c,'randomDrawId':_0x51e05e,'action':_0x6234d2};}async['checkIsUpscale'](_0x3484a1){const _0x89dacc=_0x50821a,_0xbf7486=await this[_0x89dacc(0x209)][_0x89dacc(0x1b0)]({'where':{'custom_id':_0x3484a1,'action':0x2,'status':midjourney_constant_1[_0x89dacc(0x164)][_0x89dacc(0x1e2)]}});if(_0xbf7486>0x0)throw new common_1[(_0x89dacc(0x1fc))](_0x89dacc(0x17c),common_1[_0x89dacc(0x213)]['BAD_REQUEST']);}async[_0x50821a(0x260)](_0x17aaf9,_0x134d89){const _0x47cb68=_0x50821a,_0xd7e30e=await this[_0x47cb68(0x209)][_0x47cb68(0x29d)]({'where':{'id':_0x17aaf9,'userId':_0x134d89[_0x47cb68(0x1c5)]['id'],'isDelete':0x0}});if(!_0xd7e30e)throw new common_1[(_0x47cb68(0x1fc))](_0x47cb68(0x16b),common_1[_0x47cb68(0x213)][_0x47cb68(0x160)]);if(_0xd7e30e['status']===0x2)throw new common_1[(_0x47cb68(0x1fc))]('绘制中的图片任务、禁止删除！',common_1[_0x47cb68(0x213)]['BAD_REQUEST']);const _0x4c7d3c=await this[_0x47cb68(0x209)][_0x47cb68(0x19a)]({'id':_0x17aaf9},{'isDelete':0x1});if(_0x4c7d3c[_0x47cb68(0x253)]>0x0)return _0x47cb68(0x17d);else throw new common_1[(_0x47cb68(0x1fc))](_0x47cb68(0x1c3),common_1[_0x47cb68(0x213)][_0x47cb68(0x160)]);}async[_0x50821a(0x20b)](_0x5c72da){const _0x306c56=_0x50821a,{role:_0x37ee06,id:_0x40c87a}=_0x5c72da[_0x306c56(0x1c5)],_0x297410=await this['midjourneyEntity'][_0x306c56(0x1b0)]({'where':{'userId':_0x40c87a,'isDelete':0x0,'status':(0x0,typeorm_2['In'])([0x1,0x2])}}),_0x5e1852=await this[_0x306c56(0x23a)]['getConfigs'](['mjLimitCount']),_0x240bc0=_0x5e1852?Number(_0x5e1852):0x2;if(_0x297410>=_0x240bc0)throw new common_1[(_0x306c56(0x1fc))](_0x306c56(0x1c6)+_0x240bc0+_0x306c56(0x23e),common_1[_0x306c56(0x213)][_0x306c56(0x160)]);}async[_0x50821a(0x18d)](_0x11f8ae){const _0x9b07b3=_0x50821a,{id:_0x40e9c4,userId:_0x57f8ea,action:_0x261ee4}=_0x11f8ae;console['log'](_0x9b07b3(0x263),_0x57f8ea);const _0x2e7a3f=_0x261ee4===0x2?0x1:0x4;await this[_0x9b07b3(0x2a6)][_0x9b07b3(0x18b)](_0x57f8ea,_0x2e7a3f),await this[_0x9b07b3(0x209)][_0x9b07b3(0x19a)]({'id':_0x40e9c4},{'status':0x4});}async['getList'](_0x54fc78){const _0x483899=_0x50821a,{page:page=0x1,size:size=0x14,rec:_0x159366,userId:_0xf955a3,status:_0x450759}=_0x54fc78;if(Number(size)===0x3e7){const _0x108a69=await this[_0x483899(0x172)][_0x483899(0x1cf)]({'key':_0x483899(0x23c)});if(_0x108a69)try{return JSON['parse'](_0x108a69);}catch(_0x1e51e3){return[];}}const _0x30b56e={'isDelete':0x0};_0x159366&&Object[_0x483899(0x205)](_0x30b56e,{'rec':_0x159366}),_0xf955a3&&Object['assign'](_0x30b56e,{'userId':_0xf955a3}),_0x450759&&Object[_0x483899(0x205)](_0x30b56e,{'status':_0x450759});const [_0x23c059,_0x4ce83c]=await this[_0x483899(0x209)][_0x483899(0x2a7)]({'where':_0x30b56e,'order':{'id':_0x483899(0x176)},'take':size,'skip':(page-0x1)*size,'select':[_0x483899(0x2ae),_0x483899(0x180),_0x483899(0x198),'createdAt','id',_0x483899(0x180),_0x483899(0x1e6),_0x483899(0x1df),_0x483899(0x1a9),'gk']}),_0xb209b7=await this['globalConfigService']['getConfigs']([_0x483899(0x2a1)]);_0x23c059['forEach'](_0x4ec7e4=>{const _0x1f6975=_0x483899;var _0x3b0706,_0x1e7919,_0x56fb57;try{const {extend:_0x3fcd00,isSaveImg:_0x2bd153,fileInfo:_0x4a454b}=_0x4ec7e4,_0x2ba682=(_0x3b0706=JSON['parse'](_0x4a454b))===null||_0x3b0706===void 0x0?void 0x0:_0x3b0706[_0x1f6975(0x257)];_0x4ec7e4[_0x1f6975(0x2ae)]=this[_0x1f6975(0x275)](_0x4a454b,_0x2bd153,_0xb209b7,_0x2ba682);try{const _0x2aa6e4=JSON['parse'](_0x3fcd00);_0x4ec7e4[_0x1f6975(0x1aa)]=((_0x56fb57=(_0x1e7919=_0x2aa6e4===null||_0x2aa6e4===void 0x0?void 0x0:_0x2aa6e4[_0x1f6975(0x267)])===null||_0x1e7919===void 0x0?void 0x0:_0x1e7919[0x0])===null||_0x56fb57===void 0x0?void 0x0:_0x56fb57[_0x1f6975(0x234)])==='U1';}catch(_0x501548){console[_0x1f6975(0x15e)](_0x1f6975(0x171),_0x501548),_0x4ec7e4[_0x1f6975(0x1aa)]=![];}_0x4ec7e4[_0x1f6975(0x21a)]=_0x2ba682;}catch(_0x56af2d){console[_0x1f6975(0x228)](_0x1f6975(0x28b),_0x56af2d);}});if(Number(size)===0x3e7){const _0x107eb5={'rows':_0x23c059[_0x483899(0x284)](_0x5b9677=>{const {fileInfo:_0xe5875f,prompt:_0x5e60e8,createdAt:_0xd936ba,id:_0x303c21,fullPrompt:_0x54abd9,rec:_0x38d19f,originUrl:_0x25fa7d}=_0x5b9677;return{'fileInfo':_0xe5875f,'prompt':_0x5e60e8,'createdAt':_0xd936ba,'id':_0x303c21,'fullPrompt':_0x54abd9,'rec':_0x38d19f,'originUrl':_0x25fa7d};}),'count':_0x4ce83c};return await this[_0x483899(0x172)][_0x483899(0x2a5)]({'key':'midjourney:getList','val':JSON[_0x483899(0x1ad)](_0x107eb5)},0x3c*0x5),_0x107eb5;}const _0x4ebbc9={'rows':_0x23c059,'count':_0x4ce83c};return _0x4ebbc9;}async[_0x50821a(0x273)](_0x5c7ba6){const _0x5ecfae=_0x50821a,_0x57b70a=await this[_0x5ecfae(0x209)]['findOne']({'where':{'id':_0x5c7ba6}});if(!_0x57b70a)return'';const {fullPrompt:_0x3ad0b6}=_0x57b70a;return _0x3ad0b6;}async['getAdminDrawList'](_0x292e25,_0x2b89e1){const _0xfc0cb5=_0x50821a;try{const {page:page=0x1,size:size=0xa,rec:_0x201c6b,userId:_0x114498,status:_0x16bccf}=_0x2b89e1,_0x4b4a5d={'isDelete':0x0};_0x201c6b&&Object[_0xfc0cb5(0x205)](_0x4b4a5d,{'rec':_0x201c6b}),_0x114498&&Object[_0xfc0cb5(0x205)](_0x4b4a5d,{'userId':_0x114498}),_0x16bccf&&Object[_0xfc0cb5(0x205)](_0x4b4a5d,{'status':_0x16bccf});const [_0x527157,_0x3241fa]=await this['midjourneyEntity']['findAndCount']({'where':_0x4b4a5d,'order':{'id':_0xfc0cb5(0x176)},'take':size,'skip':(page-0x1)*size}),_0x18e28b=_0x527157[_0xfc0cb5(0x284)](_0x4ecf59=>_0x4ecf59[_0xfc0cb5(0x1a0)])[_0xfc0cb5(0x1f5)](_0x170846=>_0x170846<0x186a0),_0xd708f9=await this[_0xfc0cb5(0x184)][_0xfc0cb5(0x27b)]({'where':{'id':(0x0,typeorm_2['In'])(_0x18e28b)},'select':['id',_0xfc0cb5(0x252),_0xfc0cb5(0x21e),_0xfc0cb5(0x1e8)]});_0x527157['forEach'](_0x4d724e=>{const _0x43b70a=_0xfc0cb5;_0x4d724e['userInfo']=_0xd708f9[_0x43b70a(0x27b)](_0x320db5=>_0x320db5['id']===_0x4d724e[_0x43b70a(0x1a0)]);});const _0x541560=await this[_0xfc0cb5(0x23a)][_0xfc0cb5(0x254)]([_0xfc0cb5(0x2a1)]);return _0x527157[_0xfc0cb5(0x285)](_0x467b4d=>{const _0x163580=_0xfc0cb5;var _0x1c7331,_0x2b9803,_0x573691,_0x20f4f6;try{const {extend:_0x28a52f,isSaveImg:_0x47a758,fileInfo:_0x2031e7}=_0x467b4d,_0x36bf8e=(_0x2b9803=(_0x1c7331=JSON[_0x163580(0x18a)](_0x28a52f))===null||_0x1c7331===void 0x0?void 0x0:_0x1c7331[_0x163580(0x1fd)][0x0])===null||_0x2b9803===void 0x0?void 0x0:_0x2b9803[_0x163580(0x21c)];_0x467b4d[_0x163580(0x2ae)]=this[_0x163580(0x275)](_0x2031e7,_0x47a758,_0x541560,_0x36bf8e),console[_0x163580(0x228)](_0x163580(0x262),_0x467b4d[_0x163580(0x2ae)]),_0x467b4d[_0x163580(0x1aa)]=((_0x20f4f6=(_0x573691=JSON[_0x163580(0x18a)](_0x28a52f))===null||_0x573691===void 0x0?void 0x0:_0x573691[_0x163580(0x242)][0x0])===null||_0x20f4f6===void 0x0?void 0x0:_0x20f4f6[_0x163580(0x242)][0x0]['label'])==='U1',_0x467b4d['originUrl']=_0x36bf8e;}catch(_0x571230){}}),_0x292e25[_0xfc0cb5(0x1c5)][_0xfc0cb5(0x1a2)]!=='super'&&_0x527157[_0xfc0cb5(0x285)](_0xfcd1ff=>{const _0x4a8186=_0xfc0cb5;_0xfcd1ff[_0x4a8186(0x290)]&&_0xfcd1ff[_0x4a8186(0x290)][_0x4a8186(0x1e8)]&&(_0xfcd1ff[_0x4a8186(0x290)][_0x4a8186(0x1e8)]=_0xfcd1ff[_0x4a8186(0x290)]['email'][_0x4a8186(0x1ee)](/(.{2}).+(.{2}@.+)/,'$1****$2'));}),{'rows':_0x527157,'count':_0x3241fa};}catch(_0x22fd26){throw new common_1[(_0xfc0cb5(0x1fc))]('查询失败！',common_1[_0xfc0cb5(0x213)]['BAD_REQUEST']);}}async['recDraw'](_0x32e4ab){const _0x173257=_0x50821a,{id:_0xf44899}=_0x32e4ab,_0x259d7d=await this['midjourneyEntity'][_0x173257(0x29d)]({'where':{'id':_0xf44899,'status':0x3,'isDelete':0x0}});if(!_0x259d7d)throw new common_1[(_0x173257(0x1fc))]('当前图片不存在！',common_1[_0x173257(0x213)]['BAD_REQUEST']);const {rec:_0x37fa71}=_0x259d7d,_0x4525f8=await this[_0x173257(0x209)][_0x173257(0x19a)]({'id':_0xf44899},{'rec':_0x37fa71===0x1?0x0:0x1});if(_0x4525f8[_0x173257(0x253)]>0x0)return _0x173257(0x166);}async[_0x50821a(0x1f2)](){const _0x1f4303=_0x50821a;try{await this[_0x1f4303(0x209)][_0x1f4303(0x19a)]({'status':0x2},{'status':0x4});}catch(_0x54b15b){console[_0x1f4303(0x228)](_0x1f4303(0x24a),_0x54b15b);}}async[_0x50821a(0x1b4)](_0xacd5ea,_0x83b89d){const _0x15c0bc=_0x50821a,{id:_0x213690}=_0x83b89d;if(!_0x213690)throw new common_1[(_0x15c0bc(0x1fc))](_0x15c0bc(0x1ba),common_1[_0x15c0bc(0x213)][_0x15c0bc(0x160)]);const _0xb49369=await this[_0x15c0bc(0x209)]['delete']({'id':_0x213690});if(_0xb49369[_0x15c0bc(0x253)]>0x0)return _0x15c0bc(0x175);else throw new common_1['HttpException'](_0x15c0bc(0x293),common_1['HttpStatus'][_0x15c0bc(0x160)]);}async[_0x50821a(0x18c)](_0x2cad8d,_0x354363){const _0x24c036=_0x50821a;try{const {prompt:_0x453b0a,status:_0x44d9b1,isCarryParams:_0x22e825,title:_0x26847c,order:_0x56b200,id:_0x2beb18,aspect:_0x2ecb53}=_0x354363;return _0x2beb18?await this[_0x24c036(0x200)][_0x24c036(0x19a)]({'id':_0x2beb18},{'prompt':_0x453b0a,'status':_0x44d9b1,'isCarryParams':_0x22e825,'order':_0x56b200,'aspect':_0x2ecb53}):await this[_0x24c036(0x200)][_0x24c036(0x1ae)]({'prompt':_0x453b0a,'status':_0x44d9b1,'isCarryParams':_0x22e825,'title':_0x26847c,'order':_0x56b200,'aspect':_0x2ecb53});}catch(_0x3a3222){console[_0x24c036(0x228)](_0x24c036(0x2b3),_0x3a3222);}}async[_0x50821a(0x233)](_0x2141a7,_0x3d506e){const _0x4c7a26=_0x50821a,{id:_0x154a9c}=_0x3d506e;if(!_0x154a9c)throw new common_1[(_0x4c7a26(0x1fc))](_0x4c7a26(0x1ba),common_1[_0x4c7a26(0x213)][_0x4c7a26(0x160)]);return await this[_0x4c7a26(0x200)][_0x4c7a26(0x25f)]({'id':_0x154a9c});}async[_0x50821a(0x294)](){const _0x284b15=_0x50821a;return await this[_0x284b15(0x200)]['find']({'order':{'order':_0x284b15(0x176)}});}async[_0x50821a(0x227)](_0x1f85d6){const _0x3288d0=_0x50821a,{url:_0x4adc9c}=_0x1f85d6;if(!_0x4adc9c)return;const _0x4719ba=await axios_1[_0x3288d0(0x264)][_0x3288d0(0x1cf)](_0x4adc9c,{'responseType':_0x3288d0(0x296)}),_0x4cf25b=Buffer['from'](_0x4719ba['data'])[_0x3288d0(0x24b)](_0x3288d0(0x212));return _0x4cf25b;}};MidjourneyService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x50821a(0x1f7)])(midjourney_entity_1[_0x50821a(0x1a7)])),__param(0x1,(0x0,typeorm_1[_0x50821a(0x1f7)])(tishici_entity_1[_0x50821a(0x265)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(huihuaeg_entity_1[_0x50821a(0x2b0)])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x50821a(0x22e)])),__param(0x4,(0x0,typeorm_1[_0x50821a(0x1f7)])(prompt_entity_1['mjPromptEntity'])),__metadata(_0x50821a(0x1ce),[typeorm_2[_0x50821a(0x1a4)],typeorm_2[_0x50821a(0x1a4)],typeorm_2[_0x50821a(0x1a4)],typeorm_2[_0x50821a(0x1a4)],typeorm_2[_0x50821a(0x1a4)],globalConfig_service_1[_0x50821a(0x226)],upload_service_1[_0x50821a(0x18f)],badwords_service_1[_0x50821a(0x24d)],userBalance_service_1[_0x50821a(0x169)],redisCache_service_1[_0x50821a(0x297)]])],MidjourneyService),exports[_0x50821a(0x1d8)]=MidjourneyService;