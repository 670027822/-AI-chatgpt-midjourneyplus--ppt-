'use strict';const _0x3c2d42=_0x2b40;(function(_0x291ef5,_0x192b39){const _0x38feb4=_0x2b40,_0x55d6f2=_0x291ef5();while(!![]){try{const _0x31f2bb=parseInt(_0x38feb4(0x127))/0x1+-parseInt(_0x38feb4(0x13e))/0x2*(-parseInt(_0x38feb4(0x132))/0x3)+parseInt(_0x38feb4(0x12c))/0x4*(parseInt(_0x38feb4(0x12d))/0x5)+-parseInt(_0x38feb4(0x118))/0x6*(parseInt(_0x38feb4(0x135))/0x7)+-parseInt(_0x38feb4(0x131))/0x8*(parseInt(_0x38feb4(0x144))/0x9)+-parseInt(_0x38feb4(0x11f))/0xa+parseInt(_0x38feb4(0x117))/0xb;if(_0x31f2bb===_0x192b39)break;else _0x55d6f2['push'](_0x55d6f2['shift']());}catch(_0xda9dbf){_0x55d6f2['push'](_0x55d6f2['shift']());}}}(_0x167d,0xadb1b));Object[_0x3c2d42(0x143)](exports,_0x3c2d42(0x114),{'value':!![]}),exports['huoquurl']=exports[_0x3c2d42(0x138)]=exports['sendMessageFromOpenAi']=void 0x0;function _0x2b40(_0xed4c3a,_0x157dc6){const _0x167d9a=_0x167d();return _0x2b40=function(_0x2b4056,_0x22e049){_0x2b4056=_0x2b4056-0x10e;let _0x3ddffa=_0x167d9a[_0x2b4056];return _0x3ddffa;},_0x2b40(_0xed4c3a,_0x157dc6);}const axios_1=require(_0x3c2d42(0x133)),tiktoken_1=require(_0x3c2d42(0x13c)),utils_1=require(_0x3c2d42(0x116)),tokenizer=(0x0,tiktoken_1[_0x3c2d42(0x120)])(_0x3c2d42(0x147));function _0x167d(){const _0x4a16ba=['choices','cl100k_base','application/json','Bearer\x20','usage','log','stop','gpt-4-vision-preview','url','__esModule','data','../../common/utils','6879730DyrmWW','3286518FaEDsz','unshift','replace','huoquurl','data:','default','POST','3890300FptPFC','get_encoding','current\x20request\x20options:\x20','preview','sendMessageFromOpenAi','content','slice','role','833449yLZyVq','gpt-4','stringify','end','trim','1810372IhpJAx','5IfBzjn','image_url','filter','parse\x20Error','4801040ojanAB','435HVsNuD','axios','detail','14hMcqVd','https://api.openai.com','parse','getTokenCount','length','delta','https://gpt.mylaws.top/upload.php','@dqbd/tiktoken','stream','12202FOHkhi','endsWith','json','text','split','defineProperty','9sbflcb','includes'];_0x167d=function(){return _0x4a16ba;};return _0x167d();}function getFullUrl(_0x3e1907){const _0x5a4316=_0x3c2d42,_0x210344=_0x3e1907[_0x5a4316(0x13f)]('/')?_0x3e1907[_0x5a4316(0x125)](0x0,-0x1):_0x3e1907,_0x4e7871=_0x210344||_0x5a4316(0x136);return _0x4e7871+'/v1/chat/completions';}function sendMessageFromOpenAi(_0x2a9558,_0x19ca01){const _0x41a6e8=_0x3c2d42;var _0x121f0d;const {onProgress:_0x12a896,maxToken:_0x120f67,apiKey:_0x4c8ac1,model:_0x2d96e0,temperature:temperature=0.95,proxyUrl:_0x26db31,imgsup3:_0x4950dd}=_0x19ca01;console[_0x41a6e8(0x110)](_0x41a6e8(0x121),_0x4c8ac1,_0x2d96e0,_0x120f67,_0x26db31);const _0x250409=compilerToken(_0x2d96e0,_0x120f67);if(_0x2d96e0===_0x41a6e8(0x112)&&_0x4950dd[_0x41a6e8(0x139)]>0x0){let _0x123160={'type':_0x41a6e8(0x141),'text':_0x2a9558[_0x2a9558[_0x41a6e8(0x139)]-0x1]['content']};_0x4950dd[_0x41a6e8(0x119)](_0x123160),_0x2a9558[_0x2a9558[_0x41a6e8(0x139)]-0x1][_0x41a6e8(0x124)]=_0x4950dd;}const _0x3a279a={'method':_0x41a6e8(0x11e),'url':getFullUrl(_0x26db31),'responseType':_0x41a6e8(0x13d),'headers':{'Content-Type':_0x41a6e8(0x148),'Authorization':_0x41a6e8(0x10e)+(0x0,utils_1['removeSpecialCharacters'])(_0x4c8ac1)},'data':{'max_tokens':_0x250409,'stream':!![],'temperature':temperature,'model':_0x2d96e0,'messages':_0x2a9558}},_0x16d556=(_0x121f0d=_0x2a9558[_0x2a9558['length']-0x1])===null||_0x121f0d===void 0x0?void 0x0:_0x121f0d[_0x41a6e8(0x124)];return new Promise(async(_0x4f3632,_0x4d25d8)=>{const _0x18890d=_0x41a6e8;try{const _0x1bab67=await(0x0,axios_1[_0x18890d(0x11d)])(_0x3a279a),_0x809093=_0x1bab67[_0x18890d(0x115)];let _0x2d5dbd={'text':''};_0x809093['on'](_0x18890d(0x115),_0x532787=>{const _0x1f84b3=_0x18890d;var _0x50c3ca;const _0x2bf954=_0x532787['toString']()[_0x1f84b3(0x142)]('\x0a\x0a')[_0x1f84b3(0x12f)](_0x344a9a=>_0x344a9a[_0x1f84b3(0x12b)]()!=='');for(const _0x312aa4 of _0x2bf954){const _0x3f6d28=_0x312aa4[_0x1f84b3(0x11a)](_0x1f84b3(0x11c),'');let _0x48c6df=![];try{_0x48c6df=JSON[_0x1f84b3(0x137)](_0x3f6d28)[_0x1f84b3(0x146)][0x0]['finish_reason']===_0x1f84b3(0x111);}catch(_0x3902ef){_0x48c6df=![];}if(_0x3f6d28==='[DONE]'||_0x48c6df)return _0x2d5dbd[_0x1f84b3(0x141)]=_0x2d5dbd[_0x1f84b3(0x141)][_0x1f84b3(0x12b)](),_0x2d5dbd;try{const _0x18d839=JSON[_0x1f84b3(0x137)](_0x3f6d28);_0x18d839['id']&&(_0x2d5dbd['id']=_0x18d839['id']);if((_0x50c3ca=_0x18d839[_0x1f84b3(0x146)])===null||_0x50c3ca===void 0x0?void 0x0:_0x50c3ca[_0x1f84b3(0x139)]){const _0x23e64a=_0x18d839[_0x1f84b3(0x146)][0x0][_0x1f84b3(0x13a)];_0x2d5dbd['delta']=_0x23e64a['content'];if(_0x23e64a===null||_0x23e64a===void 0x0?void 0x0:_0x23e64a['content'])_0x2d5dbd[_0x1f84b3(0x141)]+=_0x23e64a[_0x1f84b3(0x124)];_0x23e64a['role']&&(_0x2d5dbd[_0x1f84b3(0x126)]=_0x23e64a[_0x1f84b3(0x126)]),_0x2d5dbd['detail']=_0x18d839;}_0x12a896&&_0x12a896({'text':_0x2d5dbd['text']});}catch(_0x4e49fe){console['log'](_0x1f84b3(0x130),_0x3f6d28);}}}),_0x809093['on'](_0x18890d(0x12a),()=>{const _0x24b0ce=_0x18890d;if(_0x2d5dbd[_0x24b0ce(0x134)]&&_0x2d5dbd[_0x24b0ce(0x141)]){const _0x3c0d59=getTokenCount(_0x16d556),_0x3c1021=getTokenCount(JSON[_0x24b0ce(0x129)](_0x2d5dbd[_0x24b0ce(0x141)]));_0x2d5dbd['detail'][_0x24b0ce(0x10f)]={'prompt_tokens':_0x3c0d59,'completion_tokens':_0x3c1021,'total_tokens':_0x3c0d59+_0x3c1021,'estimated':!![]};}return _0x4f3632(_0x2d5dbd);});}catch(_0x2a6482){_0x4d25d8(_0x2a6482);}});}exports[_0x3c2d42(0x123)]=sendMessageFromOpenAi;function getTokenCount(_0x3e9478){const _0x3909d8=_0x3c2d42;if(!_0x3e9478)return 0x0;return _0x3e9478=String(_0x3e9478)[_0x3909d8(0x11a)](/<\|endoftext\|>/g,''),tokenizer['encode'](_0x3e9478)['length'];}exports['getTokenCount']=getTokenCount;function compilerToken(_0x4614e7,_0x4b91ad){const _0x31b964=_0x3c2d42;let _0x1e58e9=0x0;return _0x4614e7[_0x31b964(0x145)](3.5)&&(_0x1e58e9=_0x4b91ad>0x1000?0x1000:_0x4b91ad),_0x4614e7['includes'](_0x31b964(0x128))&&(_0x1e58e9=_0x4b91ad>0x2000?0x2000:_0x4b91ad),_0x4614e7[_0x31b964(0x145)](_0x31b964(0x122))&&(_0x1e58e9=_0x4b91ad>0x1000?0x1000:_0x4b91ad),_0x4614e7[_0x31b964(0x145)]('32k')&&(_0x1e58e9=_0x4b91ad>0x8000?0x8000:_0x4b91ad),_0x1e58e9;}async function huoquurl(_0x19fb51){const _0x256b84=_0x3c2d42;let _0x20ba11=_0x19fb51,_0xa6f873=_0x20ba11[0x0]['image_url'];try{const _0x5badd4=new URLSearchParams();_0x5badd4['append'](_0x256b84(0x113),_0xa6f873);const _0x765cc1=await fetch(_0x256b84(0x13b),{'method':_0x256b84(0x11e),'headers':{'Content-Type':'application/x-www-form-urlencoded','Accept':_0x256b84(0x148)},'body':_0x5badd4});if(!_0x765cc1['ok'])throw new Error('HTTP\x20error!\x20status:\x20'+_0x765cc1['status']);console['log']('response',_0x765cc1);let _0x467075=await _0x765cc1[_0x256b84(0x140)]();console['log']('url44',_0x467075);let _0x37e236=_0x467075[_0x256b84(0x113)];return _0x20ba11[0x0][_0x256b84(0x12e)]=_0x37e236,console[_0x256b84(0x110)]('biaoji60'),console[_0x256b84(0x110)](_0x20ba11),console[_0x256b84(0x110)](_0x37e236),_0x20ba11;}catch(_0x318700){console[_0x256b84(0x110)]('请求失败',_0x318700);throw _0x318700;}}exports[_0x3c2d42(0x11b)]=huoquurl;