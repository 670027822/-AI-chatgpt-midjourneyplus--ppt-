'use strict';const _0x2a2749=_0x354a;(function(_0x4a07ed,_0x3dcb58){const _0x2af726=_0x354a,_0x345742=_0x4a07ed();while(!![]){try{const _0xc5ae09=-parseInt(_0x2af726(0x111))/0x1+-parseInt(_0x2af726(0xc2))/0x2+parseInt(_0x2af726(0xc6))/0x3+-parseInt(_0x2af726(0xf0))/0x4+parseInt(_0x2af726(0x11e))/0x5+-parseInt(_0x2af726(0x10d))/0x6+parseInt(_0x2af726(0x115))/0x7;if(_0xc5ae09===_0x3dcb58)break;else _0x345742['push'](_0x345742['shift']());}catch(_0x2f7a67){_0x345742['push'](_0x345742['shift']());}}}(_0x128a,0x5c3ef));var __decorate=this&&this[_0x2a2749(0xc4)]||function(_0x5c622b,_0x213b83,_0x3146a8,_0x50ca09){const _0x25293b=_0x2a2749;var _0x16cf54=arguments[_0x25293b(0x103)],_0x58332d=_0x16cf54<0x3?_0x213b83:_0x50ca09===null?_0x50ca09=Object[_0x25293b(0xc3)](_0x213b83,_0x3146a8):_0x50ca09,_0x2a5177;if(typeof Reflect===_0x25293b(0xea)&&typeof Reflect['decorate']==='function')_0x58332d=Reflect['decorate'](_0x5c622b,_0x213b83,_0x3146a8,_0x50ca09);else{for(var _0x47537b=_0x5c622b['length']-0x1;_0x47537b>=0x0;_0x47537b--)if(_0x2a5177=_0x5c622b[_0x47537b])_0x58332d=(_0x16cf54<0x3?_0x2a5177(_0x58332d):_0x16cf54>0x3?_0x2a5177(_0x213b83,_0x3146a8,_0x58332d):_0x2a5177(_0x213b83,_0x3146a8))||_0x58332d;}return _0x16cf54>0x3&&_0x58332d&&Object['defineProperty'](_0x213b83,_0x3146a8,_0x58332d),_0x58332d;},__metadata=this&&this[_0x2a2749(0xf4)]||function(_0x34ba68,_0x8cefc5){const _0xe89eab=_0x2a2749;if(typeof Reflect===_0xe89eab(0xea)&&typeof Reflect['metadata']===_0xe89eab(0x121))return Reflect[_0xe89eab(0xff)](_0x34ba68,_0x8cefc5);};Object['defineProperty'](exports,_0x2a2749(0xdb),{'value':!![]}),exports[_0x2a2749(0x109)]=void 0x0;function _0x354a(_0x4d30cc,_0x3433cb){const _0x128a3f=_0x128a();return _0x354a=function(_0x354a2a,_0x2d1931){_0x354a2a=_0x354a2a-0xc2;let _0x30c1f5=_0x128a3f[_0x354a2a];return _0x30c1f5;},_0x354a(_0x4d30cc,_0x3433cb);}function _0x128a(){const _0x107909=['get','appId:\x20','checkAutoReply','genXmlMsgByConfig','@nestjs/common','update','createHash','非法参数','来自公众号的回复问题\x20=======>\x20超时导致问题无法回答完整','./../auth/auth.service','metadata','BAD_REQUEST','digest','&code=','length','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','&noncestr=','scanedSceneStrMap','wechatAccessToken','hex','OfficialService','getJsapiTicket','wechatOfficialAppSecret','now','372888rEnWdp','getRedirectUrl','scanBindWx','genXmlMsg','205108QYcGRA','globalConfigService',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','jiangly','2314494CSCGnA','autoreplyService','&grant_type=authorization_code','jsapiTicket:\x20',']]></Content>\x0a\x20\x20\x20\x20</xml>','bindWx','chatSyncFree','getQRCodeTicket','./../chatgpt/chatgpt.service','3031930CCXimG','fetchQRCodeTicket','createRandomNonceStr','function','getUserById','default','loginByCode','officialAutoReplyText','1454652SBBPhO','getOwnPropertyDescriptor','__decorate','&secret=','1992852nTEUrQ','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','wechatOfficialAppId','race','aotoPlay','UserService','wechatJsapiTicket','getQRSceneStrByBind','sha1','QR_STR_SCENE','getConfigs','getQRSceneStr','verify','userService','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','&timestamp=',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','sceneStrMap','authService','fromusername','bindWxBySceneStr','__esModule','HttpException','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','../../common/utils','sort','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','loginByOpenId','loginBySceneStr','来自公众号的询问问题\x20=======>\x20','jsapi_ticket=','getUserFromOpenId','HttpStatus','getTime','crypto','Injectable','object','AuthService','&url=','./../user/user.service','chatgptService','getUserOpenId','915564NHZpYL','log','&redirect_uri=','user','__metadata'];_0x128a=function(){return _0x107909;};return _0x128a();}const chatgpt_service_1=require(_0x2a2749(0x11d)),globalConfig_service_1=require('./../globalConfig/globalConfig.service'),auth_service_1=require(_0x2a2749(0xfe)),user_service_1=require(_0x2a2749(0xed)),autoreply_service_1=require('./../autoreply/autoreply.service'),common_1=require(_0x2a2749(0xf9)),crypto=require(_0x2a2749(0xe8)),axios_1=require('axios'),utils_1=require(_0x2a2749(0xde));let OfficialService=class OfficialService{constructor(_0x5f85b3,_0x1127eb,_0x1c8702,_0x3d512e,_0x2c8f31){const _0x7452b1=_0x2a2749;this[_0x7452b1(0x116)]=_0x5f85b3,this[_0x7452b1(0xd3)]=_0x1127eb,this[_0x7452b1(0xd8)]=_0x1c8702,this[_0x7452b1(0x112)]=_0x3d512e,this[_0x7452b1(0xee)]=_0x2c8f31,this[_0x7452b1(0xd7)]={},this[_0x7452b1(0x106)]={};}async['onModuleInit'](){const _0x8d0b6a=_0x2a2749;await this[_0x8d0b6a(0x112)]['getWechatAccessToken'](!![]);}async[_0x2a2749(0xd1)](_0x5d5099){const _0x113a6e=_0x2a2749,{invitedBy:_0x3c8ae4}=_0x5d5099;let _0x33d7b2=(0x0,utils_1[_0x113a6e(0x120)])(0x20);return _0x3c8ae4&&(_0x33d7b2+=':'+_0x3c8ae4),this[_0x113a6e(0xd7)][_0x33d7b2]=!![],_0x33d7b2;}async[_0x2a2749(0xcd)](_0x3a9624){const _0x59be17=_0x2a2749,{id:_0xf37500}=_0x3a9624[_0x59be17(0xf3)],_0xfdfc6b=(0x0,utils_1[_0x59be17(0x120)])(0x20)+'/'+_0xf37500;return this[_0x59be17(0xd7)][_0xfdfc6b]=!![],_0xfdfc6b;}async[_0x2a2749(0x11c)](_0x1a1079){const _0x2b0fb0=_0x2a2749;return this[_0x2b0fb0(0x11f)](_0x1a1079);}async[_0x2a2749(0x10e)](_0x20557a){const _0x472f3c=_0x2a2749,_0x14251e=await this[_0x472f3c(0x112)][_0x472f3c(0xd0)]([_0x472f3c(0xc8)]),_0x36b2c0=_0x472f3c(0xc7)+_0x14251e+_0x472f3c(0xf2)+encodeURIComponent(_0x20557a)+'&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect';return console[_0x472f3c(0xf1)]('回跳跳转地址:\x20',_0x36b2c0),_0x36b2c0;}async[_0x2a2749(0x10a)](_0x534bc9){const _0x175fb7=_0x2a2749,_0x51333f=(0x0,utils_1[_0x175fb7(0x120)])(0x20),_0x3fa726=(Date[_0x175fb7(0x10c)]()/0x3e8)['toFixed'](0x0),_0x31209d=await this[_0x175fb7(0x112)][_0x175fb7(0xd0)]([_0x175fb7(0xcc)]);console[_0x175fb7(0xf1)](_0x175fb7(0x118),_0x31209d);const _0x3b2c41=await this['globalConfigService'][_0x175fb7(0xd0)]([_0x175fb7(0xc8)]);console[_0x175fb7(0xf1)](_0x175fb7(0xf6),_0x3b2c41);const _0x458932=_0x175fb7(0xe4)+_0x31209d+_0x175fb7(0x105)+_0x51333f+_0x175fb7(0xd5)+_0x3fa726+_0x175fb7(0xec)+_0x534bc9;console[_0x175fb7(0xf1)]('str:\x20',_0x458932);const _0x32565e=this[_0x175fb7(0xce)](_0x458932);return{'appId':_0x3b2c41,'nonceStr':_0x51333f,'timestamp':_0x3fa726,'signature':_0x32565e};}async[_0x2a2749(0x11f)](_0x1f963f){const _0x3519ff=_0x2a2749,_0x47b51b=await this[_0x3519ff(0x112)][_0x3519ff(0xd0)]([_0x3519ff(0x107)]),_0x1f48f7={'action_name':_0x3519ff(0xcf),'action_info':{'scene':{'scene_str':_0x1f963f}}},_0x28012c=await axios_1[_0x3519ff(0x123)]['post'](_0x3519ff(0xe0)+_0x47b51b,_0x1f48f7),{data:{errmsg:_0x432a1c,ticket:_0x59f799}}=_0x28012c;if(_0x432a1c)throw new common_1[(_0x3519ff(0xdc))](_0x432a1c,common_1[_0x3519ff(0xe6)]['BAD_REQUEST']);return _0x59f799;}async[_0x2a2749(0x124)](_0x60058f,_0x2f7753){const _0x3fd9a1=_0x2a2749,_0xa3b497=await this[_0x3fd9a1(0x112)][_0x3fd9a1(0xd0)]([_0x3fd9a1(0xc8)]),_0x48e1e7=await this['globalConfigService'][_0x3fd9a1(0xd0)]([_0x3fd9a1(0x10b)]),_0x5ddf4b=await axios_1[_0x3fd9a1(0x123)][_0x3fd9a1(0xf5)](_0x3fd9a1(0xdd)+_0xa3b497+_0x3fd9a1(0xc5)+_0x48e1e7+_0x3fd9a1(0x102)+_0x2f7753+_0x3fd9a1(0x117)),{data:{errmsg:_0x24a9b7,openid:_0x3c42c2}}=_0x5ddf4b;if(_0x24a9b7)throw new common_1[(_0x3fd9a1(0xdc))](_0x24a9b7,common_1[_0x3fd9a1(0xe6)]['BAD_REQUEST']);let _0x19d976;return _0x19d976=await this['userService'][_0x3fd9a1(0xef)](_0x3c42c2),!_0x19d976&&(_0x19d976=await this[_0x3fd9a1(0xd3)][_0x3fd9a1(0xe5)](_0x3c42c2)),this[_0x3fd9a1(0xd8)][_0x3fd9a1(0xe1)](_0x19d976,_0x60058f);}async['scan'](_0xae7c98,_0x4a01b4){const _0x4d0749=_0x2a2749;if(!this['sceneStrMap'][_0x4a01b4])throw new common_1[(_0x4d0749(0xdc))](_0x4d0749(0xfc),common_1[_0x4d0749(0xe6)]['BAD_REQUEST']);const _0x3bcde3=await this[_0x4d0749(0xd3)][_0x4d0749(0xe5)](_0xae7c98,_0x4a01b4);this[_0x4d0749(0x106)][_0x4a01b4]=_0x3bcde3['id'];}async[_0x2a2749(0xe2)](_0x18ec7f,_0x4dff78){const _0x5e0c06=_0x2a2749;if(!this[_0x5e0c06(0xd7)][_0x4dff78])return;const _0xb12e3a=this[_0x5e0c06(0x106)][_0x4dff78];if(!_0xb12e3a)return'';const _0x269450=await this[_0x5e0c06(0xd3)][_0x5e0c06(0x122)](_0xb12e3a);return delete this[_0x5e0c06(0x106)][_0x4dff78],this[_0x5e0c06(0xd8)][_0x5e0c06(0xe1)](_0x269450,_0x18ec7f);}async[_0x2a2749(0x10f)](_0x55c84d,_0xe3b336){const _0x422b73=_0x2a2749;if(!this['sceneStrMap'][_0xe3b336])throw new common_1[(_0x422b73(0xdc))](_0x422b73(0xfc),common_1[_0x422b73(0xe6)][_0x422b73(0x100)]);const _0x26c8bf=_0xe3b336['split']('/')[0x1],_0x5089c8=await this[_0x422b73(0xd3)][_0x422b73(0x11a)](_0x55c84d,_0x26c8bf);this[_0x422b73(0x106)][_0xe3b336]=_0x5089c8;}async[_0x2a2749(0xda)](_0x366667,_0xcfeecf){const _0x1026a9=_0x2a2749;if(!this['sceneStrMap'][_0xcfeecf])throw new common_1[(_0x1026a9(0xdc))](_0x1026a9(0xfc),common_1[_0x1026a9(0xe6)][_0x1026a9(0x100)]);const {id:_0x3d4f09}=_0x366667[_0x1026a9(0xf3)],_0x2498f7=this[_0x1026a9(0x106)][_0xcfeecf];if(!_0x2498f7)return'';return delete this[_0x1026a9(0x106)][_0xcfeecf],_0x2498f7;}async[_0x2a2749(0xd2)](_0x64f187,_0x5f5d51,_0x1e42c3){const _0x5127eb=_0x2a2749,_0x4cf2e7=await this[_0x5127eb(0x112)][_0x5127eb(0xd0)](['wechatOfficialToken'])||_0x5127eb(0x114);return await this['sha1']([_0x4cf2e7,_0x5f5d51,_0x1e42c3][_0x5127eb(0xdf)]()['join'](''))==_0x64f187;}[_0x2a2749(0xce)](_0x381f92){const _0x37f3d1=_0x2a2749;return crypto[_0x37f3d1(0xfb)]('sha1')[_0x37f3d1(0xfa)](_0x381f92)[_0x37f3d1(0x101)](_0x37f3d1(0x108));}async[_0x2a2749(0xf8)](_0x67ff08,_0x560417){const _0x151a75=_0x2a2749,_0x31e93c=await this[_0x151a75(0x112)][_0x151a75(0xd0)]([_0x560417]);return this[_0x151a75(0x110)](_0x67ff08,_0x31e93c);}async[_0x2a2749(0x110)](_0x2dbd84,_0x2b0f94){const _0x401b7f=_0x2a2749;return'\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA['+_0x2dbd84[_0x401b7f(0xd9)][0x0]+_0x401b7f(0xd6)+_0x2dbd84['tousername'][0x0]+_0x401b7f(0x113)+new Date()[_0x401b7f(0xe7)]()+_0x401b7f(0x104)+_0x2b0f94+_0x401b7f(0x119);}async[_0x2a2749(0xca)](_0xe92347){const _0x1eb822=_0x2a2749,_0x3cb063=new Promise((_0x4b9904,_0x634c42)=>{setTimeout(()=>{_0x634c42(new Error('请求超时'));},0x12c0);});let _0x4aaf6a='';try{console['log'](_0x1eb822(0xe3),_0xe92347);const _0x2a8d12=await Promise[_0x1eb822(0xc9)]([this[_0x1eb822(0xee)][_0x1eb822(0x11b)](_0xe92347),_0x3cb063]);_0x4aaf6a=_0x2a8d12||await this[_0x1eb822(0x116)][_0x1eb822(0xf7)](_0xe92347);}catch(_0x45c3b9){console[_0x1eb822(0xf1)](_0x1eb822(0xfd)),_0x4aaf6a=await this['globalConfigService'][_0x1eb822(0xd0)]([_0x1eb822(0x125)])||_0x1eb822(0xd4);}return _0x4aaf6a;}};OfficialService=__decorate([(0x0,common_1[_0x2a2749(0xe9)])(),__metadata('design:paramtypes',[autoreply_service_1['AutoreplyService'],user_service_1[_0x2a2749(0xcb)],auth_service_1[_0x2a2749(0xeb)],globalConfig_service_1['GlobalConfigService'],chatgpt_service_1['ChatgptService']])],OfficialService),exports[_0x2a2749(0x109)]=OfficialService;