'use strict';const _0x305843=_0x4cc8;(function(_0x1680bd,_0x4b671f){const _0xa6d61c=_0x4cc8,_0x524770=_0x1680bd();while(!![]){try{const _0x161614=-parseInt(_0xa6d61c(0x21b))/0x1+-parseInt(_0xa6d61c(0x220))/0x2+parseInt(_0xa6d61c(0x1f2))/0x3+parseInt(_0xa6d61c(0x1fe))/0x4*(-parseInt(_0xa6d61c(0x201))/0x5)+parseInt(_0xa6d61c(0x21a))/0x6*(-parseInt(_0xa6d61c(0x218))/0x7)+-parseInt(_0xa6d61c(0x215))/0x8+parseInt(_0xa6d61c(0x221))/0x9;if(_0x161614===_0x4b671f)break;else _0x524770['push'](_0x524770['shift']());}catch(_0x11226f){_0x524770['push'](_0x524770['shift']());}}}(_0x2fdc,0x75c14));function _0x4cc8(_0x43eb90,_0x572ccd){const _0x2fdccc=_0x2fdc();return _0x4cc8=function(_0x4cc895,_0x514758){_0x4cc895=_0x4cc895-0x1ea;let _0xbe9f63=_0x2fdccc[_0x4cc895];return _0xbe9f63;},_0x4cc8(_0x43eb90,_0x572ccd);}var __decorate=this&&this[_0x305843(0x1f9)]||function(_0xc1eb1f,_0x48445d,_0x1d6dc7,_0x29f9c1){const _0x209c1a=_0x305843;var _0x51c31a=arguments[_0x209c1a(0x1ed)],_0x33e295=_0x51c31a<0x3?_0x48445d:_0x29f9c1===null?_0x29f9c1=Object[_0x209c1a(0x20d)](_0x48445d,_0x1d6dc7):_0x29f9c1,_0x4bcf80;if(typeof Reflect==='object'&&typeof Reflect[_0x209c1a(0x1f3)]===_0x209c1a(0x21f))_0x33e295=Reflect[_0x209c1a(0x1f3)](_0xc1eb1f,_0x48445d,_0x1d6dc7,_0x29f9c1);else{for(var _0x189328=_0xc1eb1f['length']-0x1;_0x189328>=0x0;_0x189328--)if(_0x4bcf80=_0xc1eb1f[_0x189328])_0x33e295=(_0x51c31a<0x3?_0x4bcf80(_0x33e295):_0x51c31a>0x3?_0x4bcf80(_0x48445d,_0x1d6dc7,_0x33e295):_0x4bcf80(_0x48445d,_0x1d6dc7))||_0x33e295;}return _0x51c31a>0x3&&_0x33e295&&Object['defineProperty'](_0x48445d,_0x1d6dc7,_0x33e295),_0x33e295;},__metadata=this&&this['__metadata']||function(_0x27fe2d,_0x2afd6d){const _0x3a4e05=_0x305843;if(typeof Reflect===_0x3a4e05(0x228)&&typeof Reflect['metadata']===_0x3a4e05(0x21f))return Reflect['metadata'](_0x27fe2d,_0x2afd6d);},__param=this&&this[_0x305843(0x1f1)]||function(_0x503bc8,_0x3f807f){return function(_0x516adf,_0x39c964){_0x3f807f(_0x516adf,_0x39c964,_0x503bc8);};};Object[_0x305843(0x1ec)](exports,_0x305843(0x222),{'value':!![]}),exports['ChatGroupService']=void 0x0;const common_1=require('@nestjs/common'),chatGroup_entity_1=require(_0x305843(0x22e)),typeorm_1=require(_0x305843(0x21c)),typeorm_2=require('typeorm'),app_entity_1=require(_0x305843(0x1eb)),models_service_1=require(_0x305843(0x229));let ChatGroupService=class ChatGroupService{constructor(_0x3a1173,_0x679c2f,_0x53c41b){const _0x37db8c=_0x305843;this[_0x37db8c(0x231)]=_0x3a1173,this[_0x37db8c(0x1f6)]=_0x679c2f,this['modelsService']=_0x53c41b;}async[_0x305843(0x204)](_0x142873,_0x3643af){const _0x1f9551=_0x305843,{id:_0x322efa}=_0x3643af[_0x1f9551(0x203)],{appId:_0x211950}=_0x142873,_0x51e027={'title':_0x1f9551(0x230),'userId':_0x322efa};if(_0x211950){const _0x8c4f31=await this[_0x1f9551(0x1f6)][_0x1f9551(0x20f)]({'where':{'id':_0x211950}});if(!_0x8c4f31)throw new common_1[(_0x1f9551(0x217))](_0x1f9551(0x211),common_1['HttpStatus'][_0x1f9551(0x232)]);else{const {status:_0x2e953c,name:_0x5a3050}=_0x8c4f31,_0x4b92ea=await this[_0x1f9551(0x231)][_0x1f9551(0x210)]({'where':{'userId':_0x322efa,'appId':_0x211950,'isDelete':![]}});if(_0x4b92ea>0x0)throw new common_1[(_0x1f9551(0x217))]('当前应用已经开启了一个对话无需新建了！',common_1[_0x1f9551(0x1ee)]['BAD_REQUEST']);if(![0x1,0x3,0x4,0x5]['includes'](_0x2e953c))throw new common_1[(_0x1f9551(0x217))](_0x1f9551(0x219),common_1[_0x1f9551(0x1ee)]['BAD_REQUEST']);_0x5a3050&&(_0x51e027['title']=_0x5a3050),_0x211950&&(_0x51e027['appId']=_0x211950);}}const _0x11739b=await this[_0x1f9551(0x20b)][_0x1f9551(0x202)](_0x211950);_0x211950&&(_0x11739b[_0x1f9551(0x227)]=_0x211950);if(!_0x11739b)throw new common_1[(_0x1f9551(0x217))](_0x1f9551(0x22b),common_1[_0x1f9551(0x1ee)][_0x1f9551(0x232)]);return await this[_0x1f9551(0x231)][_0x1f9551(0x1ef)](Object[_0x1f9551(0x1f8)](Object[_0x1f9551(0x1f8)]({},_0x51e027),{'config':JSON[_0x1f9551(0x1fb)](_0x11739b)}));}async[_0x305843(0x21e)](_0x4c004c){const _0x421d99=_0x305843;try{const {id:_0x1ec4df}=_0x4c004c['user'],_0x148f84={'userId':_0x1ec4df,'isDelete':![]},_0x1831ec=await this[_0x421d99(0x231)]['find']({'where':_0x148f84,'order':{'isSticky':_0x421d99(0x1fd),'id':_0x421d99(0x1fd)}}),_0x451f46=_0x1831ec['filter'](_0x3c51ac=>_0x3c51ac['appId'])[_0x421d99(0x1fc)](_0x265676=>_0x265676[_0x421d99(0x227)]),_0x3c65bf=await this['appEntity'][_0x421d99(0x21d)]({'where':{'id':(0x0,typeorm_2['In'])(_0x451f46)}});return _0x1831ec[_0x421d99(0x1fc)](_0x1fd8b4=>{const _0x1faa1d=_0x421d99;var _0x1b06e5;return _0x1fd8b4[_0x1faa1d(0x213)]=(_0x1b06e5=_0x3c65bf['find'](_0x10fcdc=>_0x10fcdc['id']===_0x1fd8b4[_0x1faa1d(0x227)]))===null||_0x1b06e5===void 0x0?void 0x0:_0x1b06e5[_0x1faa1d(0x1ea)],_0x1fd8b4;});}catch(_0x52cfc5){console[_0x421d99(0x20a)](_0x421d99(0x20c),_0x52cfc5);}}async[_0x305843(0x20e)](_0x4e14f0,_0x350845){const _0x598131=_0x305843,{title:_0x2cd7da,isSticky:_0x27b174,groupId:_0x13b3e7,config:_0x139631}=_0x4e14f0,{id:_0x2263f2}=_0x350845[_0x598131(0x203)],_0x1f985b=await this[_0x598131(0x231)]['findOne']({'where':{'id':_0x13b3e7,'userId':_0x2263f2}});if(!_0x1f985b)throw new common_1[(_0x598131(0x217))](_0x598131(0x22d),common_1[_0x598131(0x1ee)][_0x598131(0x232)]);const {appId:_0x16fbd3}=_0x1f985b;if(_0x16fbd3&&!_0x2cd7da)try{const _0x4d971b=JSON[_0x598131(0x1f4)](_0x139631);if(Number(_0x4d971b[_0x598131(0x224)])!==0x1)throw new common_1[(_0x598131(0x217))](_0x598131(0x226),common_1['HttpStatus'][_0x598131(0x232)]);}catch(_0x14ab17){}const _0x500a37={};_0x2cd7da&&(_0x500a37[_0x598131(0x200)]=_0x2cd7da),typeof _0x27b174!=='undefined'&&(_0x500a37[_0x598131(0x1f7)]=_0x27b174),_0x139631&&(_0x500a37[_0x598131(0x216)]=_0x139631);const _0x5aeb7b=await this['chatGroupEntity'][_0x598131(0x20e)]({'id':_0x13b3e7},_0x500a37);if(_0x5aeb7b[_0x598131(0x1f0)])return!![];else throw new common_1[(_0x598131(0x217))](_0x598131(0x1f5),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x305843(0x207)](_0x2b4972,_0x29915f){const _0x48a2bd=_0x305843,{groupId:_0x5a3703}=_0x2b4972,{id:_0x4e6305}=_0x29915f[_0x48a2bd(0x203)],_0x1ad16e=await this['chatGroupEntity']['findOne']({'where':{'id':_0x5a3703,'userId':_0x4e6305}});if(!_0x1ad16e)throw new common_1[(_0x48a2bd(0x217))](_0x48a2bd(0x1ff),common_1[_0x48a2bd(0x1ee)][_0x48a2bd(0x232)]);const _0xa3dc68=await this[_0x48a2bd(0x231)][_0x48a2bd(0x20e)]({'id':_0x5a3703},{'isDelete':!![]});if(_0xa3dc68['affected'])return _0x48a2bd(0x208);else throw new common_1[(_0x48a2bd(0x217))](_0x48a2bd(0x22f),common_1[_0x48a2bd(0x1ee)][_0x48a2bd(0x232)]);}async[_0x305843(0x1fa)](_0x4c870c){const _0x3c58f7=_0x305843,{id:_0xcab267}=_0x4c870c[_0x3c58f7(0x203)],_0x314aef=await this['chatGroupEntity'][_0x3c58f7(0x20e)]({'userId':_0xcab267,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x314aef[_0x3c58f7(0x1f0)])return'删除成功';else throw new common_1[(_0x3c58f7(0x217))](_0x3c58f7(0x22f),common_1[_0x3c58f7(0x1ee)][_0x3c58f7(0x232)]);}async[_0x305843(0x206)](_0x595516){const _0x99876c=_0x305843;if(!_0x595516)return;return await this[_0x99876c(0x231)][_0x99876c(0x20f)]({'where':{'id':_0x595516}});}};function _0x2fdc(){const _0x2e64b1=['HttpException','6606257aYGsJq','非法操作、您在使用一个未启用的应用！','6sNqaRy','891151jSakVL','@nestjs/typeorm','find','query','function','537938XmFfGt','23167197hJPbxf','__esModule','ChatGroupEntity','keyType','AppEntity','应用对话名称不能修改哟！','appId','object','../models/models.service','ChatGroupService','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','InjectRepository','请先选择一个对话或者新加一个对话再操作！','./chatGroup.entity','删除失败！','新对话','chatGroupEntity','BAD_REQUEST','coverImg','../app/app.entity','defineProperty','length','HttpStatus','save','affected','__param','1948050fONARK','decorate','parse','更新对话失败！','appEntity','isSticky','assign','__decorate','delAll','stringify','map','DESC','508328JQTabp','非法操作、您在删除一个非法资源！','title','20hcaZjN','getBaseConfig','user','create','Repository','getGroupInfoFromId','del','删除成功','design:paramtypes','log','modelsService','error:\x20','getOwnPropertyDescriptor','update','findOne','count','非法操作、您在使用一个不存在的应用！','Injectable','appLogo','ModelsService','1031680CIYwXe','config'];_0x2fdc=function(){return _0x2e64b1;};return _0x2fdc();}ChatGroupService=__decorate([(0x0,common_1[_0x305843(0x212)])(),__param(0x0,(0x0,typeorm_1[_0x305843(0x22c)])(chatGroup_entity_1[_0x305843(0x223)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(app_entity_1[_0x305843(0x225)])),__metadata(_0x305843(0x209),[typeorm_2[_0x305843(0x205)],typeorm_2['Repository'],models_service_1[_0x305843(0x214)]])],ChatGroupService),exports[_0x305843(0x22a)]=ChatGroupService;